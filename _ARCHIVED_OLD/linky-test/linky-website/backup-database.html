<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linky ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë„êµ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .warning {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            color: #92400E;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        button {
            padding: 12px 24px;
            background: #3B82F6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #2563EB;
        }
        button:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
        }
        .danger {
            background: #DC2626;
        }
        .danger:hover {
            background: #B91C1C;
        }
        .success {
            background: #22c55e;
        }
        .success:hover {
            background: #16a34a;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #f3f4f6;
            font-weight: bold;
        }
        .json-download {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—„ï¸ Linky ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ë° ë¶„ì„</h1>
        
        <div class="warning">
            <strong>âš ï¸ ì£¼ì˜ì‚¬í•­:</strong> ì´ ë„êµ¬ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ìœ„í•œ ë°±ì—… ë„êµ¬ì…ë‹ˆë‹¤. 
            ì‹¤í–‰ ì „ Supabase ëŒ€ì‹œë³´ë“œì—ì„œë„ ë°±ì—…ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
        </div>

        <!-- Step 1: í˜„ì¬ êµ¬ì¡° ë¶„ì„ -->
        <div class="section">
            <h2>Step 1: í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë¶„ì„</h2>
            <p>í˜„ì¬ users í…Œì´ë¸”ì˜ êµ¬ì¡°ì™€ ë°ì´í„°ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>
            
            <button onclick="analyzeCurrentStructure()">ğŸ“Š êµ¬ì¡° ë¶„ì„</button>
            <button onclick="checkConstraints()">ğŸ”’ ì œì•½ì¡°ê±´ í™•ì¸</button>
            <button onclick="countUsersByType()">ğŸ‘¥ ì‚¬ìš©ì íƒ€ì…ë³„ í†µê³„</button>
            
            <div id="structureResult" class="result" style="display: none;"></div>
        </div>

        <!-- Step 2: ë°ì´í„° ë°±ì—… -->
        <div class="section">
            <h2>Step 2: ë°ì´í„° ë°±ì—…</h2>
            <p>ëª¨ë“  ì‚¬ìš©ì ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°±ì—…í•©ë‹ˆë‹¤.</p>
            
            <button onclick="backupAllUsers()">ğŸ’¾ ì „ì²´ ì‚¬ìš©ì ë°±ì—…</button>
            <button onclick="backupBusinessUsers()">ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤ ì‚¬ìš©ìë§Œ ë°±ì—…</button>
            <button onclick="backupPartnerUsers()">ğŸ¤ íŒŒíŠ¸ë„ˆ ì‚¬ìš©ìë§Œ ë°±ì—…</button>
            
            <div id="backupResult" class="result" style="display: none;"></div>
            <a id="downloadLink" class="json-download" download="backup.json">ë‹¤ìš´ë¡œë“œ</a>
        </div>

        <!-- Step 3: ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ -->
        <div class="section">
            <h2>Step 3: ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ ìƒíƒœ í™•ì¸</h2>
            <p>ìƒˆ í…Œì´ë¸” êµ¬ì¡°ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ì¤€ë¹„ê°€ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
            
            <button onclick="checkMigrationReadiness()">âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ ìƒíƒœ í™•ì¸</button>
            <button onclick="generateMigrationSQL()">ğŸ“ ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ìƒì„±</button>
            
            <div id="migrationResult" class="result" style="display: none;"></div>
        </div>

        <!-- Step 4: ë°±ì—… í…Œì´ë¸” ìƒì„± -->
        <div class="section">
            <h2>Step 4: ë°±ì—… í…Œì´ë¸” ìƒì„± (ì„ íƒì‚¬í•­)</h2>
            <p>Supabaseì— ë°±ì—… í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>
            
            <button onclick="createBackupTable()" class="danger">ğŸ”´ ë°±ì—… í…Œì´ë¸” ìƒì„±</button>
            <span style="color: #6b7280; font-size: 14px;">â€» ì‹¤ì œ í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤. ì‹ ì¤‘íˆ ì‹¤í–‰í•˜ì„¸ìš”.</span>
            
            <div id="backupTableResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script>
        // Supabase í´ë¼ì´ì–¸íŠ¸ ê°€ì ¸ì˜¤ê¸°
        function getSupabase() {
            return window.supabaseClient || null;
        }

        // Step 1: í˜„ì¬ êµ¬ì¡° ë¶„ì„
        async function analyzeCurrentStructure() {
            const resultDiv = document.getElementById('structureResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ë¶„ì„ ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                // ìƒ˜í”Œ ë°ì´í„°ë¡œ êµ¬ì¡° íŒŒì•…
                const { data: sample, error } = await supabase
                    .from('users')
                    .select('*')
                    .limit(1);

                if (error) {
                    resultDiv.innerHTML = `âŒ ì˜¤ë¥˜: ${error.message}`;
                    return;
                }

                let result = 'ğŸ“Š Users í…Œì´ë¸” êµ¬ì¡° ë¶„ì„\n\n';

                if (sample && sample.length > 0) {
                    const columns = Object.keys(sample[0]);
                    result += 'ë°œê²¬ëœ ì»¬ëŸ¼:\n';
                    columns.forEach(col => {
                        const value = sample[0][col];
                        const type = value === null ? 'null' : 
                                    Array.isArray(value) ? 'array' : 
                                    typeof value;
                        result += `- ${col} (${type})\n`;
                    });

                    result += '\nìƒ˜í”Œ ë°ì´í„°:\n';
                    result += JSON.stringify(sample[0], null, 2);
                } else {
                    result += 'í…Œì´ë¸”ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.';
                }

                resultDiv.innerHTML = result;
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // ì œì•½ì¡°ê±´ í™•ì¸
        async function checkConstraints() {
            const resultDiv = document.getElementById('structureResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'í™•ì¸ ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                // ê° íƒ€ì…ë³„ ìµœì†Œ ë°ì´í„°ë¡œ ì œì•½ì¡°ê±´ í…ŒìŠ¤íŠ¸
                const tests = [
                    {
                        name: 'Business ìµœì†Œ í•„ë“œ (phone í¬í•¨)',
                        data: {
                            uid: 'constraint-test-biz-' + Date.now(),
                            email: 'test@constraint.com',
                            name: 'ì œì•½ì¡°ê±´ í…ŒìŠ¤íŠ¸',
                            phone: '010-0000-0000',
                            type: 'business',
                            status: 'pending',
                            created_at: new Date().toISOString()
                        }
                    },
                    {
                        name: 'Partner ìµœì†Œ í•„ë“œ (phone í¬í•¨)',
                        data: {
                            uid: 'constraint-test-partner-' + Date.now(),
                            email: 'test@constraint.com',
                            name: 'ì œì•½ì¡°ê±´ í…ŒìŠ¤íŠ¸',
                            phone: '010-0000-0000',
                            type: 'partner',
                            status: 'pending',
                            created_at: new Date().toISOString()
                        }
                    }
                ];

                let result = 'ğŸ”’ ì œì•½ì¡°ê±´ ë¶„ì„ ê²°ê³¼:\n\n';

                for (const test of tests) {
                    const { error } = await supabase
                        .from('users')
                        .insert(test.data);

                    if (error) {
                        result += `âŒ ${test.name}: ${error.message}\n`;
                        if (error.details) {
                            result += `   ìƒì„¸: ${error.details}\n`;
                        }
                    } else {
                        result += `âœ… ${test.name}: ì„±ê³µ\n`;
                        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
                        await supabase.from('users').delete().eq('uid', test.data.uid);
                    }
                    result += '\n';
                }

                resultDiv.innerHTML = result;
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // ì‚¬ìš©ì íƒ€ì…ë³„ í†µê³„
        async function countUsersByType() {
            const resultDiv = document.getElementById('structureResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ì§‘ê³„ ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                // ì „ì²´ ì‚¬ìš©ì ìˆ˜
                const { count: totalCount } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });

                // ë¹„ì¦ˆë‹ˆìŠ¤ ì‚¬ìš©ì ìˆ˜
                const { count: businessCount } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('type', 'business');

                // íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ìˆ˜
                const { count: partnerCount } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true })
                    .eq('type', 'partner');

                // ìƒíƒœë³„ í†µê³„
                const { data: statusStats } = await supabase
                    .from('users')
                    .select('type, status');

                const stats = {};
                if (statusStats) {
                    statusStats.forEach(user => {
                        const key = `${user.type}_${user.status}`;
                        stats[key] = (stats[key] || 0) + 1;
                    });
                }

                let result = 'ğŸ‘¥ ì‚¬ìš©ì í†µê³„:\n\n';
                result += `ì „ì²´ ì‚¬ìš©ì: ${totalCount || 0}ëª…\n`;
                result += `â”œâ”€â”€ ë¹„ì¦ˆë‹ˆìŠ¤: ${businessCount || 0}ëª…\n`;
                result += `â””â”€â”€ íŒŒíŠ¸ë„ˆ: ${partnerCount || 0}ëª…\n\n`;
                
                result += 'ìƒíƒœë³„ ë¶„ë¥˜:\n';
                Object.entries(stats).forEach(([key, count]) => {
                    const [type, status] = key.split('_');
                    result += `- ${type} (${status}): ${count}ëª…\n`;
                });

                resultDiv.innerHTML = result;
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // Step 2: ë°ì´í„° ë°±ì—…
        async function backupAllUsers() {
            await backupUsers();
        }

        async function backupBusinessUsers() {
            await backupUsers('business');
        }

        async function backupPartnerUsers() {
            await backupUsers('partner');
        }

        async function backupUsers(type = null) {
            const resultDiv = document.getElementById('backupResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ë°±ì—… ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                let query = supabase.from('users').select('*');
                
                if (type) {
                    query = query.eq('type', type);
                }

                const { data, error } = await query;

                if (error) {
                    resultDiv.innerHTML = `âŒ ë°±ì—… ì‹¤íŒ¨: ${error.message}`;
                    return;
                }

                const backup = {
                    timestamp: new Date().toISOString(),
                    type: type || 'all',
                    count: data.length,
                    data: data
                };

                // JSON íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì¤€ë¹„
                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const downloadLink = document.getElementById('downloadLink');
                downloadLink.href = url;
                downloadLink.download = `linky_users_backup_${type || 'all'}_${Date.now()}.json`;
                downloadLink.style.display = 'inline-block';

                resultDiv.innerHTML = `âœ… ë°±ì—… ì™„ë£Œ!\n\n`;
                resultDiv.innerHTML += `ë°±ì—…ëœ ì‚¬ìš©ì ìˆ˜: ${data.length}ëª…\n`;
                resultDiv.innerHTML += `ë°±ì—… íƒ€ì…: ${type || 'ì „ì²´'}\n`;
                resultDiv.innerHTML += `ë°±ì—… ì‹œê°„: ${new Date().toLocaleString()}\n\n`;
                resultDiv.innerHTML += `ì•„ë˜ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ ë°±ì—… íŒŒì¼ì„ ì €ì¥í•˜ì„¸ìš”.`;

                // ìë™ ë‹¤ìš´ë¡œë“œ
                downloadLink.click();
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // Step 3: ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ ìƒíƒœ í™•ì¸
        async function checkMigrationReadiness() {
            const resultDiv = document.getElementById('migrationResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'í™•ì¸ ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                let result = 'âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ ìƒíƒœ:\n\n';
                let ready = true;

                // 1. ì‚¬ìš©ì ìˆ˜ í™•ì¸
                const { count } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });

                result += `1. ì „ì²´ ì‚¬ìš©ì ìˆ˜: ${count || 0}ëª…\n`;

                // 2. í•„ìˆ˜ í•„ë“œ í™•ì¸
                const { data: sampleUsers } = await supabase
                    .from('users')
                    .select('*')
                    .limit(10);

                if (sampleUsers && sampleUsers.length > 0) {
                    const requiredFields = ['uid', 'email', 'name', 'type', 'phone'];
                    let missingFields = new Set();

                    sampleUsers.forEach(user => {
                        requiredFields.forEach(field => {
                            if (!user[field]) {
                                missingFields.add(field);
                            }
                        });
                    });

                    if (missingFields.size > 0) {
                        result += `2. âš ï¸ ì¼ë¶€ ì‚¬ìš©ìì—ê²Œ í•„ìˆ˜ í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤: ${Array.from(missingFields).join(', ')}\n`;
                        ready = false;
                    } else {
                        result += `2. âœ… ëª¨ë“  í•„ìˆ˜ í•„ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤.\n`;
                    }
                }

                // 3. íƒ€ì…ë³„ ë¶„í¬ í™•ì¸
                const { data: typeStats } = await supabase
                    .from('users')
                    .select('type');

                const typeCount = {};
                typeStats?.forEach(user => {
                    typeCount[user.type] = (typeCount[user.type] || 0) + 1;
                });

                result += `3. ì‚¬ìš©ì íƒ€ì… ë¶„í¬:\n`;
                Object.entries(typeCount).forEach(([type, count]) => {
                    result += `   - ${type}: ${count}ëª…\n`;
                });

                result += `\n${ready ? 'âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤€ë¹„ ì™„ë£Œ!' : 'âš ï¸ ì¼ë¶€ ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í•©ë‹ˆë‹¤.'}`;

                resultDiv.innerHTML = result;
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // ë§ˆì´ê·¸ë ˆì´ì…˜ SQL ìƒì„±
        function generateMigrationSQL() {
            const resultDiv = document.getElementById('migrationResult');
            resultDiv.style.display = 'block';
            
            const sql = `-- Linky ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ SQL
-- ìƒì„±ì¼: ${new Date().toISOString()}

-- 1. ë°±ì—… í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS users_backup AS SELECT * FROM users;

-- 2. ìƒˆ í…Œì´ë¸” ìƒì„±
-- ë¹„ì¦ˆë‹ˆìŠ¤ ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE business_users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  auth_uid UUID UNIQUE REFERENCES auth.users(id),
  email TEXT UNIQUE NOT NULL,
  phone TEXT NOT NULL,
  status TEXT DEFAULT 'pending',
  
  -- ë¹„ì¦ˆë‹ˆìŠ¤ ì •ë³´
  business_name TEXT NOT NULL,
  business_number TEXT NOT NULL,
  business_type TEXT NOT NULL,
  business_address TEXT NOT NULL,
  representative_name TEXT NOT NULL,
  
  -- ë©”íƒ€ë°ì´í„°
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE partner_users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  auth_uid UUID UNIQUE REFERENCES auth.users(id),
  email TEXT UNIQUE NOT NULL,
  phone TEXT NOT NULL,
  status TEXT DEFAULT 'pending',
  
  -- íŒŒíŠ¸ë„ˆ ì •ë³´
  name TEXT NOT NULL,
  residence TEXT NOT NULL,
  work_areas TEXT[] NOT NULL,
  
  -- ë©”íƒ€ë°ì´í„°
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. RLS í™œì„±í™”
ALTER TABLE business_users ENABLE ROW LEVEL SECURITY;
ALTER TABLE partner_users ENABLE ROW LEVEL SECURITY;

-- 4. RLS ì •ì±… ìƒì„±
CREATE POLICY "Users can view own business profile" ON business_users
  FOR SELECT USING (auth.uid() = auth_uid);

CREATE POLICY "Users can view own partner profile" ON partner_users
  FOR SELECT USING (auth.uid() = auth_uid);`;

            resultDiv.innerHTML = `<div class="code-block">${sql}</div>`;
            resultDiv.innerHTML += '<p>ìœ„ SQLì„ Supabase SQL Editorì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.</p>';
        }

        // Step 4: ë°±ì—… í…Œì´ë¸” ìƒì„±
        async function createBackupTable() {
            const resultDiv = document.getElementById('backupTableResult');
            resultDiv.style.display = 'block';
            
            if (!confirm('ì •ë§ë¡œ ë°±ì—… í…Œì´ë¸”ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.')) {
                resultDiv.innerHTML = 'ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.';
                return;
            }

            resultDiv.innerHTML = 'ë°±ì—… í…Œì´ë¸” ìƒì„± ì¤‘...';

            try {
                const supabase = getSupabase();
                if (!supabase) {
                    resultDiv.innerHTML = 'âŒ Supabaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                    return;
                }

                // RPC í•¨ìˆ˜ê°€ ì—†ìœ¼ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ ë°±ì—…í•´ì•¼ í•¨
                resultDiv.innerHTML = `âš ï¸ ë°±ì—… í…Œì´ë¸” ìƒì„±ì€ Supabase ëŒ€ì‹œë³´ë“œì—ì„œ ì§ì ‘ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.\n\n`;
                resultDiv.innerHTML += `1. Supabase ëŒ€ì‹œë³´ë“œë¡œ ì´ë™\n`;
                resultDiv.innerHTML += `2. SQL Editor ì—´ê¸°\n`;
                resultDiv.innerHTML += `3. ë‹¤ìŒ SQL ì‹¤í–‰:\n\n`;
                resultDiv.innerHTML += `<div class="code-block">CREATE TABLE users_backup_${Date.now()} AS SELECT * FROM users;</div>`;
            } catch (err) {
                resultDiv.innerHTML = `âŒ ì˜ˆì™¸ ë°œìƒ: ${err.message}`;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ Supabase ìƒíƒœ í™•ì¸
        window.onload = function() {
            setTimeout(() => {
                const supabase = getSupabase();
                if (!supabase) {
                    alert('Supabaseê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            }, 1000);
        };
    </script>
</body>
</html>