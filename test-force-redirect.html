<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>강제 리다이렉트 테스트</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #333; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; min-height: 100px; }
    </style>
</head>
<body>
    <h1>🚀 강제 리다이렉트 메서드 테스트</h1>
    
    <div class="test">
        <h2>테스트 1: 모든 리다이렉트 방법 시도</h2>
        <button onclick="testAllRedirectMethods()">모든 방법 테스트</button>
        <div id="test1Log" class="log"></div>
    </div>

    <div class="test">
        <h2>테스트 2: Meta 태그 리다이렉트</h2>
        <button onclick="testMetaRedirect()">Meta 태그 테스트</button>
        <div id="test2Log" class="log"></div>
    </div>

    <div class="test">
        <h2>테스트 3: 폼 제출 리다이렉트</h2>
        <button onclick="testFormRedirect()">Form 제출 테스트</button>
        <div id="test3Log" class="log"></div>
    </div>

    <div class="test">
        <h2>테스트 4: 앵커 클릭 리다이렉트</h2>
        <button onclick="testAnchorRedirect()">앵커 클릭 테스트</button>
        <div id="test4Log" class="log"></div>
    </div>

    <script>
        function log(testId, message) {
            const logDiv = document.getElementById(testId + 'Log');
            logDiv.innerHTML += `${new Date().toISOString()}: ${message}<br>`;
            console.log(message);
        }

        // 1. 모든 JavaScript 리다이렉트 방법
        function testAllRedirectMethods() {
            const methods = [
                {
                    name: 'window.location.href',
                    fn: () => window.location.href = 'index.html'
                },
                {
                    name: 'window.location.replace()',
                    fn: () => window.location.replace('index.html')
                },
                {
                    name: 'window.location.assign()',
                    fn: () => window.location.assign('index.html')
                },
                {
                    name: 'window.location = string',
                    fn: () => window.location = 'index.html'
                },
                {
                    name: 'window.location.pathname',
                    fn: () => {
                        const path = window.location.pathname;
                        const dir = path.substring(0, path.lastIndexOf('/'));
                        window.location.pathname = dir + '/index.html';
                    }
                },
                {
                    name: 'document.location.href',
                    fn: () => document.location.href = 'index.html'
                },
                {
                    name: 'window.open() same window',
                    fn: () => window.open('index.html', '_self')
                },
                {
                    name: 'history.pushState + reload',
                    fn: () => {
                        history.pushState({}, '', 'index.html');
                        location.reload();
                    }
                }
            ];

            methods.forEach((method, index) => {
                setTimeout(() => {
                    log('test1', `Testing: ${method.name}`);
                    try {
                        // 실제로 실행하지 않고 시뮬레이션
                        const result = method.fn.toString();
                        log('test1', `✅ ${method.name} would work`);
                    } catch (e) {
                        log('test1', `❌ ${method.name} error: ${e.message}`);
                    }
                }, index * 100);
            });

            // 실제로 동작하는 리다이렉트 (주석 해제하여 사용)
            // setTimeout(() => {
            //     log('test1', '실제 리다이렉트 실행...');
            //     window.location.href = 'index.html';
            // }, methods.length * 100 + 500);
        }

        // 2. Meta 태그 리다이렉트
        function testMetaRedirect() {
            log('test2', 'Creating meta refresh tag...');
            
            const meta = document.createElement('meta');
            meta.httpEquiv = 'refresh';
            meta.content = '3; url=index.html';
            document.head.appendChild(meta);
            
            log('test2', 'Meta tag added - will redirect in 3 seconds');
            
            let countdown = 3;
            const timer = setInterval(() => {
                log('test2', `Redirecting in ${countdown}...`);
                countdown--;
                if (countdown <= 0) {
                    clearInterval(timer);
                    // 실제로는 meta 태그가 리다이렉트 처리
                    document.head.removeChild(meta);
                    log('test2', 'Meta tag removed (실제 환경에서는 리다이렉트됨)');
                }
            }, 1000);
        }

        // 3. 폼 제출 리다이렉트
        function testFormRedirect() {
            log('test3', 'Creating hidden form...');
            
            const form = document.createElement('form');
            form.method = 'GET';
            form.action = 'index.html';
            form.style.display = 'none';
            
            document.body.appendChild(form);
            log('test3', 'Form created and added to body');
            
            // 실제 제출 (주석 해제하여 사용)
            // log('test3', 'Submitting form...');
            // form.submit();
            
            // 시뮬레이션
            log('test3', 'Form would submit to: ' + form.action);
            document.body.removeChild(form);
        }

        // 4. 앵커 클릭 리다이렉트
        function testAnchorRedirect() {
            log('test4', 'Creating hidden anchor...');
            
            const anchor = document.createElement('a');
            anchor.href = 'index.html';
            anchor.style.display = 'none';
            anchor.id = 'hiddenRedirect';
            
            document.body.appendChild(anchor);
            log('test4', 'Anchor created: ' + anchor.href);
            
            // 프로그래밍적 클릭
            log('test4', 'Triggering click event...');
            anchor.click();
            
            // MouseEvent로 시도
            log('test4', 'Triggering MouseEvent...');
            const event = new MouseEvent('click', {
                view: window,
                bubbles: true,
                cancelable: true
            });
            anchor.dispatchEvent(event);
            
            log('test4', 'Click events dispatched');
            document.body.removeChild(anchor);
        }

        // 최종 해결책: 강제 리다이렉트 함수
        window.forceRedirect = function(url) {
            console.log('🚨 Force redirect to:', url);
            
            // 방법 1: 기본
            try {
                window.location.href = url;
                return;
            } catch (e) {
                console.error('Method 1 failed:', e);
            }
            
            // 방법 2: replace
            try {
                window.location.replace(url);
                return;
            } catch (e) {
                console.error('Method 2 failed:', e);
            }
            
            // 방법 3: assign
            try {
                window.location.assign(url);
                return;
            } catch (e) {
                console.error('Method 3 failed:', e);
            }
            
            // 방법 4: meta refresh
            try {
                const meta = document.createElement('meta');
                meta.httpEquiv = 'refresh';
                meta.content = '0; url=' + url;
                document.head.appendChild(meta);
                return;
            } catch (e) {
                console.error('Method 4 failed:', e);
            }
            
            // 방법 5: form submit
            try {
                const form = document.createElement('form');
                form.method = 'GET';
                form.action = url;
                document.body.appendChild(form);
                form.submit();
                return;
            } catch (e) {
                console.error('Method 5 failed:', e);
            }
            
            // 모든 방법 실패
            console.error('❌ All redirect methods failed!');
            alert('리다이렉트할 수 없습니다. 수동으로 이동해주세요: ' + url);
        };
    </script>
</body>
</html>