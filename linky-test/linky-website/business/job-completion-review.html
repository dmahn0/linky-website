<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>작업 완료 검토 - Linky Business</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- Firebase 설정 -->
    <script src="../firebase-config.js"></script>
    
    <!-- 공통 스타일 -->
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/components.css">
    
    <style>
        .review-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8fafc;
            min-height: calc(100vh - 200px);
        }
        
        .review-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .job-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .summary-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .summary-value {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }
        
        /* 파트너 정보 섹션 */
        .partner-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .partner-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .partner-avatar {
            width: 60px;
            height: 60px;
            background: #e0e7ff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #4338ca;
        }
        
        .partner-details h3 {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .partner-stats {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .rating {
            color: #f59e0b;
        }
        
        /* 체크리스트 섹션 */
        .checklist-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checklist-grid {
            display: grid;
            gap: 10px;
        }
        
        .checklist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            gap: 15px;
        }
        
        .checklist-item.completed {
            background: #e0f2fe;
        }
        
        .checklist-icon {
            font-size: 20px;
        }
        
        .checklist-text {
            flex: 1;
            color: #334155;
        }
        
        /* 사진 섹션 */
        .photos-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .photo-category {
            margin-bottom: 30px;
        }
        
        .photo-category:last-child {
            margin-bottom: 0;
        }
        
        .category-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            aspect-ratio: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s;
        }
        
        .photo-item:hover img {
            transform: scale(1.05);
        }
        
        /* 완료 메모 섹션 */
        .notes-section {
            background: #f0f9ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .notes-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 10px;
        }
        
        .notes-content {
            color: #334155;
            line-height: 1.6;
        }
        
        /* 액션 섹션 */
        .action-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .btn-approve {
            background: #10b981;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-approve:hover {
            background: #059669;
        }
        
        .btn-reject {
            background: white;
            color: #ef4444;
            padding: 15px 40px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-reject:hover {
            background: #fef2f2;
        }
        
        .info-text {
            font-size: 14px;
            color: #6b7280;
        }
        
        /* 거부 사유 모달 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .modal-close {
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .reject-reasons {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .reason-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reason-option:hover {
            background: #f1f5f9;
        }
        
        .reason-option input[type="radio"] {
            margin-right: 10px;
        }
        
        .reason-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 20px;
        }
        
        /* 사진 뷰어 모달 */
        .photo-viewer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
        }
        
        .photo-viewer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }
        
        .photo-viewer-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }
        
        .photo-viewer-close {
            position: absolute;
            top: 20px;
            right: 40px;
            font-size: 40px;
            color: white;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        /* 로딩 상태 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 반응형 */
        @media (max-width: 768px) {
            .job-summary {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .photo-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 컴포넌트 -->
    <div id="header-root"></div>
    
    <div class="review-container">
        <!-- 리뷰 헤더 -->
        <div class="review-header">
            <span class="status-badge status-pending">검토 대기</span>
            <h1>작업 완료 검토</h1>
            <div class="job-summary">
                <div class="summary-item">
                    <span class="summary-label">공간명</span>
                    <span class="summary-value" id="spaceName">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">작업일</span>
                    <span class="summary-value" id="jobDate">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">작업 시간</span>
                    <span class="summary-value" id="jobTime">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">결제 예정액</span>
                    <span class="summary-value" id="jobPrice">-</span>
                </div>
            </div>
        </div>
        
        <!-- 파트너 정보 -->
        <div class="partner-section">
            <h2 class="section-title">
                <span>👷</span>
                <span>담당 파트너</span>
            </h2>
            <div class="partner-info">
                <div class="partner-avatar" id="partnerAvatar">파</div>
                <div class="partner-details">
                    <h3 id="partnerName">-</h3>
                    <div class="partner-stats">
                        <div class="stat-item">
                            <span class="rating">⭐</span>
                            <span id="partnerRating">4.8</span>
                        </div>
                        <div class="stat-item">
                            <span>완료 작업</span>
                            <span id="partnerJobs">152건</span>
                        </div>
                        <div class="stat-item">
                            <span>경력</span>
                            <span id="partnerExperience">2년 3개월</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 체크리스트 섹션 -->
        <div class="checklist-section">
            <h2 class="section-title">
                <span>✅</span>
                <span>작업 체크리스트</span>
            </h2>
            <div class="checklist-grid" id="checklistGrid">
                <!-- 체크리스트 항목들이 여기에 동적으로 추가됩니다 -->
            </div>
        </div>
        
        <!-- 사진 섹션 -->
        <div class="photos-section">
            <h2 class="section-title">
                <span>📸</span>
                <span>작업 사진</span>
            </h2>
            
            <!-- 작업 전 사진 -->
            <div class="photo-category">
                <h3 class="category-title">작업 전</h3>
                <div class="photo-grid" id="beforePhotos">
                    <!-- 작업 전 사진들이 여기에 표시됩니다 -->
                </div>
            </div>
            
            <!-- 작업 후 사진 -->
            <div class="photo-category">
                <h3 class="category-title">작업 후</h3>
                <div class="photo-grid" id="afterPhotos">
                    <!-- 작업 후 사진들이 여기에 표시됩니다 -->
                </div>
            </div>
            
            <!-- 추가 사진 -->
            <div class="photo-category" id="additionalCategory" style="display: none;">
                <h3 class="category-title">추가 사진</h3>
                <div class="photo-grid" id="additionalPhotos">
                    <!-- 추가 사진들이 여기에 표시됩니다 -->
                </div>
            </div>
        </div>
        
        <!-- 완료 메모 -->
        <div class="notes-section" id="notesSection" style="display: none;">
            <h3 class="notes-title">파트너 메모</h3>
            <div class="notes-content" id="completionNotes">-</div>
        </div>
        
        <!-- 액션 섹션 -->
        <div class="action-section">
            <div class="action-buttons">
                <button class="btn-approve" onclick="approveCompletion()">승인하기</button>
                <button class="btn-reject" onclick="showRejectModal()">재작업 요청</button>
            </div>
            <p class="info-text">
                승인 시 파트너에게 정산이 진행되며, 재작업 요청 시 파트너에게 알림이 전송됩니다.
            </p>
        </div>
    </div>
    
    <!-- 거부 사유 모달 -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">재작업 요청 사유</h3>
                <button class="modal-close" onclick="closeRejectModal()">&times;</button>
            </div>
            
            <div class="reject-reasons">
                <label class="reason-option">
                    <input type="radio" name="rejectReason" value="incomplete">
                    <span>작업이 완료되지 않았습니다</span>
                </label>
                <label class="reason-option">
                    <input type="radio" name="rejectReason" value="quality">
                    <span>작업 품질이 기준에 미달합니다</span>
                </label>
                <label class="reason-option">
                    <input type="radio" name="rejectReason" value="photo">
                    <span>사진이 불명확하거나 누락되었습니다</span>
                </label>
                <label class="reason-option">
                    <input type="radio" name="rejectReason" value="other">
                    <span>기타</span>
                </label>
            </div>
            
            <textarea class="reason-textarea" id="rejectDetails" placeholder="상세 사유를 입력해주세요 (필수)"></textarea>
            
            <button class="btn-reject" style="width: 100%;" onclick="submitRejection()">재작업 요청하기</button>
        </div>
    </div>
    
    <!-- 사진 뷰어 모달 -->
    <div id="photoViewer" class="photo-viewer" onclick="closePhotoViewer()">
        <button class="photo-viewer-close">&times;</button>
        <div class="photo-viewer-content">
            <img id="viewerImage" src="" alt="작업 사진">
        </div>
    </div>
    
    <!-- 로딩 오버레이 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">처리 중입니다...</p>
        </div>
    </div>
    
    <!-- 푸터 컴포넌트 -->
    <div id="footer-root"></div>
    
    <!-- 공통 스크립트 -->
    <script src="../js/auth-utils.js"></script>
    <script src="../components/header.js"></script>
    <script src="../components/footer.js"></script>
    
    <script>
        let currentUser = null;
        let jobId = null;
        let jobData = null;
        
        // 페이지 초기화
        document.addEventListener('DOMContentLoaded', async function() {
            // URL 파라미터에서 작업 ID 가져오기
            const urlParams = new URLSearchParams(window.location.search);
            jobId = urlParams.get('jobId');
            
            if (!jobId) {
                alert('잘못된 접근입니다.');
                window.location.href = 'jobs.html';
                return;
            }
            
            // 헤더 초기화
            new HeaderComponent({
                showBusinessMenu: true,
                currentPage: 'jobs'
            });
            
            // 푸터 초기화
            new FooterComponent();
            
            // 인증 확인
            const { isAuthenticated, user } = await checkAuthStatus();
            if (!isAuthenticated || user.type !== 'business') {
                alert('사업자 로그인이 필요합니다.');
                window.location.href = '../index.html';
                return;
            }
            
            currentUser = user;
            
            // 작업 정보 로드
            await loadJobData();
        });
        
        // 작업 정보 로드
        async function loadJobData() {
            try {
                const jobDoc = await db.collection('jobs').doc(jobId).get();
                
                if (!jobDoc.exists) {
                    alert('작업 정보를 찾을 수 없습니다.');
                    window.location.href = 'jobs.html';
                    return;
                }
                
                jobData = jobDoc.data();
                
                // 사업자 권한 확인
                if (jobData.businessId !== currentUser.uid) {
                    alert('접근 권한이 없습니다.');
                    window.location.href = 'jobs.html';
                    return;
                }
                
                // 작업 상태 확인
                if (jobData.status !== 'pending_review') {
                    alert('검토 대기 중인 작업만 확인할 수 있습니다.');
                    window.location.href = 'jobs.html';
                    return;
                }
                
                // 작업 정보 표시
                displayJobInfo();
                
                // 파트너 정보 표시
                await displayPartnerInfo();
                
                // 완료 보고 내용 표시
                displayCompletionReport();
                
            } catch (error) {
                console.error('작업 정보 로드 오류:', error);
                alert('작업 정보를 불러오는 중 오류가 발생했습니다.');
            }
        }
        
        // 작업 정보 표시
        function displayJobInfo() {
            document.getElementById('spaceName').textContent = jobData.spaceInfo?.name || '-';
            document.getElementById('jobDate').textContent = jobData.schedule?.requestedDate || '-';
            document.getElementById('jobTime').textContent = jobData.schedule?.requestedTime || '-';
            document.getElementById('jobPrice').textContent = `₩${(jobData.pricing?.totalPrice || 0).toLocaleString()}`;
        }
        
        // 파트너 정보 표시
        async function displayPartnerInfo() {
            try {
                const partnerDoc = await db.collection('users').doc(jobData.partnerId).get();
                
                if (partnerDoc.exists) {
                    const partnerData = partnerDoc.data();
                    
                    // 파트너 이름과 아바타
                    const partnerName = partnerData.name || '파트너';
                    document.getElementById('partnerName').textContent = partnerName;
                    document.getElementById('partnerAvatar').textContent = partnerName.charAt(0);
                    
                    // 파트너 통계 (실제로는 별도 통계 컬렉션에서 가져와야 함)
                    // 여기서는 예시 데이터 사용
                    document.getElementById('partnerRating').textContent = '4.8';
                    document.getElementById('partnerJobs').textContent = '152건';
                    document.getElementById('partnerExperience').textContent = '2년 3개월';
                }
            } catch (error) {
                console.error('파트너 정보 로드 오류:', error);
            }
        }
        
        // 완료 보고 내용 표시
        function displayCompletionReport() {
            const completion = jobData.completion;
            
            if (!completion) {
                alert('완료 보고 데이터가 없습니다.');
                window.location.href = 'jobs.html';
                return;
            }
            
            // 체크리스트 표시
            displayChecklist(completion.checklist);
            
            // 사진 표시
            displayPhotos(completion.photos);
            
            // 완료 메모 표시
            if (completion.notes) {
                document.getElementById('notesSection').style.display = 'block';
                document.getElementById('completionNotes').textContent = completion.notes;
            }
        }
        
        // 체크리스트 표시
        function displayChecklist(checklist) {
            const container = document.getElementById('checklistGrid');
            
            container.innerHTML = checklist.map(item => `
                <div class="checklist-item ${item.completed ? 'completed' : ''}">
                    <span class="checklist-icon">${item.completed ? '✅' : '⬜'}</span>
                    <span class="checklist-text">${item.item}</span>
                </div>
            `).join('');
        }
        
        // 사진 표시
        function displayPhotos(photos) {
            const beforePhotos = photos.filter(p => p.type === 'before');
            const afterPhotos = photos.filter(p => p.type === 'after');
            const additionalPhotos = photos.filter(p => p.type === 'additional');
            
            // 작업 전 사진
            const beforeContainer = document.getElementById('beforePhotos');
            beforeContainer.innerHTML = beforePhotos.map((photo, index) => `
                <div class="photo-item" onclick="viewPhoto('${photo.url}')">
                    <img src="${photo.url}" alt="작업 전 사진 ${index + 1}">
                </div>
            `).join('');
            
            // 작업 후 사진
            const afterContainer = document.getElementById('afterPhotos');
            afterContainer.innerHTML = afterPhotos.map((photo, index) => `
                <div class="photo-item" onclick="viewPhoto('${photo.url}')">
                    <img src="${photo.url}" alt="작업 후 사진 ${index + 1}">
                </div>
            `).join('');
            
            // 추가 사진
            if (additionalPhotos.length > 0) {
                document.getElementById('additionalCategory').style.display = 'block';
                const additionalContainer = document.getElementById('additionalPhotos');
                additionalContainer.innerHTML = additionalPhotos.map((photo, index) => `
                    <div class="photo-item" onclick="viewPhoto('${photo.url}')">
                        <img src="${photo.url}" alt="추가 사진 ${index + 1}">
                    </div>
                `).join('');
            }
        }
        
        // 사진 뷰어 열기
        function viewPhoto(url) {
            document.getElementById('viewerImage').src = url;
            document.getElementById('photoViewer').style.display = 'block';
        }
        
        // 사진 뷰어 닫기
        function closePhotoViewer() {
            document.getElementById('photoViewer').style.display = 'none';
        }
        
        // 작업 승인
        async function approveCompletion() {
            if (!confirm('작업을 승인하시겠습니까?\n승인 후 파트너에게 정산이 진행됩니다.')) {
                return;
            }
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = '작업을 승인하고 있습니다...';
            
            try {
                // 작업 상태 업데이트
                await db.collection('jobs').doc(jobId).update({
                    status: 'completed',
                    'completion.approvedAt': firebase.firestore.FieldValue.serverTimestamp(),
                    'completion.approvedBy': currentUser.uid
                });
                
                // 파트너 수익 기록 (실제로는 별도 정산 시스템 필요)
                await recordPartnerEarnings();
                
                // 성공 메시지 및 리다이렉트
                alert('작업이 승인되었습니다.\n파트너에게 정산이 진행됩니다.');
                window.location.href = 'jobs.html';
                
            } catch (error) {
                console.error('작업 승인 오류:', error);
                alert('작업 승인 중 오류가 발생했습니다.');
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }
        
        // 파트너 수익 기록
        async function recordPartnerEarnings() {
            const earningData = {
                partnerId: jobData.partnerId,
                jobId: jobId,
                businessId: currentUser.uid,
                amount: jobData.pricing?.partnerPrice || 0,
                status: 'pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            await db.collection('earnings').add(earningData);
        }
        
        // 재작업 요청 모달 표시
        function showRejectModal() {
            document.getElementById('rejectModal').style.display = 'block';
        }
        
        // 재작업 요청 모달 닫기
        function closeRejectModal() {
            document.getElementById('rejectModal').style.display = 'none';
            document.getElementById('rejectDetails').value = '';
            document.querySelectorAll('input[name="rejectReason"]').forEach(radio => {
                radio.checked = false;
            });
        }
        
        // 재작업 요청 제출
        async function submitRejection() {
            const selectedReason = document.querySelector('input[name="rejectReason"]:checked');
            const details = document.getElementById('rejectDetails').value.trim();
            
            if (!selectedReason) {
                alert('재작업 요청 사유를 선택해주세요.');
                return;
            }
            
            if (!details) {
                alert('상세 사유를 입력해주세요.');
                return;
            }
            
            if (!confirm('재작업을 요청하시겠습니까?\n파트너에게 알림이 전송됩니다.')) {
                return;
            }
            
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = '재작업 요청을 처리하고 있습니다...';
            
            try {
                // 작업 상태 업데이트
                await db.collection('jobs').doc(jobId).update({
                    status: 'in_progress',
                    'completion.rejected': true,
                    'completion.rejectedAt': firebase.firestore.FieldValue.serverTimestamp(),
                    'completion.rejectedBy': currentUser.uid,
                    'completion.rejectionReason': selectedReason.value,
                    'completion.rejectionDetails': details
                });
                
                // 파트너에게 알림 (실제로는 FCM 등 사용)
                console.log('재작업 알림 전송:', jobData.partnerId);
                
                // 성공 메시지 및 리다이렉트
                alert('재작업 요청이 전송되었습니다.\n파트너에게 알림이 발송되었습니다.');
                window.location.href = 'jobs.html';
                
            } catch (error) {
                console.error('재작업 요청 오류:', error);
                alert('재작업 요청 중 오류가 발생했습니다.');
            } finally {
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }
        
        // 모달 외부 클릭 시 닫기
        window.onclick = function(event) {
            const rejectModal = document.getElementById('rejectModal');
            if (event.target === rejectModal) {
                closeRejectModal();
            }
        }
    </script>
</body>
</html>