<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‘ì—… ê´€ë¦¬ - Linky Business</title>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase ì„¤ì • -->
    <script src="../supabase-config.js"></script>
    
    <!-- ì¸ì¦ ë° API -->
    <script src="../js/auth/auth-manager.js"></script>
    <script src="../js/auth/business-auth.js"></script>
    <script src="../js/api/business-api.js"></script>
    <script src="../js/auth-utils.js"></script>
    
    <!-- ê³µí†µ ìŠ¤íƒ€ì¼ -->
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/components.css">
    
    <style>
        .jobs-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #f8fafc;
            min-height: calc(100vh - 200px);
        }
        
        .page-header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tabs {
            display: flex;
            gap: 2px;
            background: #e5e7eb;
            padding: 2px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            color: #374151;
        }
        
        .tab.active {
            background: white;
            color: #22c55e;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #ef4444;
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        /* ì‘ì—… ëª©ë¡ */
        .jobs-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .job-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .job-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }
        
        .job-header {
            padding: 24px;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .job-title {
            font-size: 20px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 8px;
        }
        
        .job-meta {
            display: flex;
            gap: 20px;
            color: #6b7280;
            font-size: 14px;
        }
        
        .job-meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .job-body {
            padding: 24px;
        }
        
        .job-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .detail-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
        }
        
        .detail-value {
            font-weight: 600;
            color: #1f2937;
        }
        
        /* íŒŒíŠ¸ë„ˆ ì‹ ì²­ ì„¹ì…˜ */
        .applications-section {
            background: #f9fafb;
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
        }
        
        .applications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .applications-title {
            font-weight: 600;
            color: #374151;
        }
        
        .applications-count {
            background: #22c55e;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .applications-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .application-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .partner-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .partner-avatar {
            width: 48px;
            height: 48px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .partner-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .partner-name {
            font-weight: 600;
            color: #1f2937;
        }
        
        .partner-stats {
            display: flex;
            gap: 12px;
            font-size: 14px;
            color: #6b7280;
        }
        
        .partner-rating {
            color: #fbbf24;
        }
        
        .application-actions {
            display: flex;
            gap: 8px;
        }
        
        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-badge.accepted {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-badge.in_progress {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        .status-badge.completed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-badge.cancelled {
            background: #fee2e2;
            color: #991b1b;
        }
        
        /* ë²„íŠ¼ */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .btn-primary {
            background: #22c55e;
            color: white;
        }
        
        .btn-primary:hover {
            background: #16a34a;
        }
        
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .empty-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 12px;
        }
        
        .empty-description {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        /* ë¡œë”© */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f4f6;
            border-top: 5px solid #22c55e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .modal-body {
            margin-bottom: 30px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header id="header"></header>
    
    <!-- ì‘ì—… ê´€ë¦¬ ì»¨í…Œì´ë„ˆ -->
    <div class="jobs-container">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="page-header">
            <h1 class="page-title">ì‘ì—… ê´€ë¦¬</h1>
            <p class="page-subtitle">ì •ë¦¬ ìš”ì²­ê³¼ ì§„í–‰ ìƒí™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('all')" id="tab-all">
                ì „ì²´
            </button>
            <button class="tab" onclick="switchTab('pending')" id="tab-pending">
                ëŒ€ê¸° ì¤‘
                <span class="tab-badge" id="pending-count" style="display: none;">0</span>
            </button>
            <button class="tab" onclick="switchTab('accepted')" id="tab-accepted">
                íŒŒíŠ¸ë„ˆ ë°°ì •
            </button>
            <button class="tab" onclick="switchTab('in_progress')" id="tab-in_progress">
                ì§„í–‰ ì¤‘
            </button>
            <button class="tab" onclick="switchTab('completed')" id="tab-completed">
                ì™„ë£Œ
            </button>
        </div>
        
        <!-- ë¡œë”© ìƒíƒœ -->
        <div id="loadingState" class="loading-container" style="display: none;">
            <div class="loading-spinner"></div>
        </div>
        
        <!-- ì‘ì—… ëª©ë¡ -->
        <div id="jobsContent" style="display: none;">
            <div id="jobsList" class="jobs-list"></div>
            
            <!-- ë¹ˆ ìƒíƒœ -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ“‹</div>
                <h2 class="empty-title">ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</h2>
                <p class="empty-description" id="emptyDescription">
                    ì•„ì§ ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.
                </p>
                <a href="create-job.html" class="btn btn-primary">
                    ì²« ì •ë¦¬ ìš”ì²­í•˜ê¸°
                </a>
            </div>
        </div>
    </div>
    
    <!-- í‘¸í„° -->
    <footer id="footer"></footer>
    
    <!-- íŒŒíŠ¸ë„ˆ ìŠ¹ì¸ ëª¨ë‹¬ -->
    <div id="approveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">íŒŒíŠ¸ë„ˆ ìŠ¹ì¸</h2>
            </div>
            <div class="modal-body">
                <p>ì´ íŒŒíŠ¸ë„ˆì—ê²Œ ì‘ì—…ì„ ë§¡ê¸°ì‹œê² ìŠµë‹ˆê¹Œ?</p>
                <div style="margin-top: 20px; padding: 16px; background: #f9fafb; border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 8px;" id="modalPartnerName">-</div>
                    <div style="font-size: 14px; color: #6b7280;">
                        í‰ì : <span id="modalPartnerRating">-</span> | 
                        ì™„ë£Œ ì‘ì—…: <span id="modalPartnerJobs">-</span>ê±´
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="confirmApproval()">ìŠ¹ì¸</button>
            </div>
        </div>
    </div>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let businessProfile = null;
        let currentTab = 'all';
        let allJobs = [];
        let pendingApproval = null;
        
        // í˜ì´ì§€ ì´ˆê¸°í™”
        async function initializePage() {
            try {
                showLoading(true);
                
                // ì„¸ì…˜ í™•ì¸
                const { data: { session } } = await window.supabaseClient.auth.getSession();
                if (!session) {
                    window.location.href = './index.html';
                    return;
                }
                
                currentUser = session.user;
                
                // ë¹„ì¦ˆë‹ˆìŠ¤ í”„ë¡œí•„ í™•ì¸
                const { data: profile, error } = await window.supabaseClient
                    .from('businesses')
                    .select('*')
                    .eq('auth_uid', currentUser.id)
                    .single();
                
                if (error || !profile) {
                    alert('í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    window.location.href = 'dashboard.html';
                    return;
                }
                
                businessProfile = profile;
                
                // URL íŒŒë¼ë¯¸í„° í™•ì¸
                const urlParams = new URLSearchParams(window.location.search);
                const status = urlParams.get('status');
                if (status) {
                    currentTab = status;
                }
                
                // ì‘ì—… ëª©ë¡ ë¡œë“œ
                await loadJobs();
                
            } catch (error) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                alert('í˜ì´ì§€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                showLoading(false);
            }
        }
        
        // ì‘ì—… ëª©ë¡ ë¡œë“œ
        async function loadJobs() {
            try {
                // ì‘ì—… ëª©ë¡ ì¡°íšŒ (ê´€ë ¨ ì •ë³´ í¬í•¨)
                const { data: jobs, error } = await window.supabaseClient
                    .from('jobs')
                    .select(`
                        *,
                        space:spaces(*),
                        job_applications(
                            *,
                            partner:partners(*)
                        )
                    `)
                    .eq('business_id', currentUser.id)  // auth_uid ì‚¬ìš©
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                allJobs = jobs || [];
                displayJobs();
                updateTabCounts();
                
            } catch (error) {
                console.error('ì‘ì—… ë¡œë“œ ì˜¤ë¥˜:', error);
                alert('ì‘ì—… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì‘ì—… ëª©ë¡ í‘œì‹œ
        function displayJobs() {
            const filteredJobs = filterJobsByTab();
            const container = document.getElementById('jobsList');
            const emptyState = document.getElementById('emptyState');
            
            if (filteredJobs.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                updateEmptyMessage();
                return;
            }
            
            container.style.display = 'block';
            emptyState.style.display = 'none';
            
            container.innerHTML = filteredJobs.map(job => {
                const pendingApplications = job.job_applications?.filter(app => app.status === 'pending') || [];
                
                return `
                    <div class="job-card">
                        <div class="job-header">
                            <h3 class="job-title">${job.title}</h3>
                            <div class="job-meta">
                                <div class="job-meta-item">
                                    <span>ğŸ¢</span>
                                    <span>${job.space?.name || '-'}</span>
                                </div>
                                <div class="job-meta-item">
                                    <span>ğŸ“…</span>
                                    <span>${new Date(job.preferred_date).toLocaleDateString()}</span>
                                </div>
                                <div class="job-meta-item">
                                    <span class="status-badge ${job.status}">
                                        ${getStatusText(job.status)}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="job-body">
                            <div class="job-details">
                                <div class="detail-item">
                                    <span class="detail-label">ì‘ì—… ìœ í˜•</span>
                                    <span class="detail-value">${getJobTypeText(job.type)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ì˜ˆìƒ ë¹„ìš©</span>
                                    <span class="detail-value">â‚©${(job.price || 0).toLocaleString()}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">í¬ë§ ì‹œê°„</span>
                                    <span class="detail-value">${getTimeText(job.preferred_time)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ê¸´ê¸‰ë„</span>
                                    <span class="detail-value">${getUrgencyText(job.urgency)}</span>
                                </div>
                            </div>
                            
                            ${job.description ? `
                                <div style="margin-top: 16px; padding: 12px; background: #f9fafb; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">ìš”ì²­ì‚¬í•­</div>
                                    <div style="color: #1f2937;">${job.description}</div>
                                </div>
                            ` : ''}
                            
                            ${job.status === 'pending' && pendingApplications.length > 0 ? `
                                <div class="applications-section">
                                    <div class="applications-header">
                                        <span class="applications-title">íŒŒíŠ¸ë„ˆ ì‹ ì²­</span>
                                        <span class="applications-count">${pendingApplications.length}ëª…</span>
                                    </div>
                                    <div class="applications-list">
                                        ${pendingApplications.map(app => `
                                            <div class="application-item">
                                                <div class="partner-info">
                                                    <div class="partner-avatar">ğŸ‘·</div>
                                                    <div class="partner-details">
                                                        <div class="partner-name">${app.partner?.name || 'íŒŒíŠ¸ë„ˆ'}</div>
                                                        <div class="partner-stats">
                                                            <span class="partner-rating">â­ ${app.partner?.rating || 0}</span>
                                                            <span>ì™„ë£Œ ${app.partner?.completed_jobs || 0}ê±´</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="application-actions">
                                                    <button class="btn btn-sm btn-primary" 
                                                            onclick="approvePartner('${job.id}', '${app.id}', '${app.partner_id}', '${app.partner?.name}', ${app.partner?.rating || 0}, ${app.partner?.completed_jobs || 0})">
                                                        ìŠ¹ì¸
                                                    </button>
                                                    <button class="btn btn-sm btn-secondary" 
                                                            onclick="rejectPartner('${job.id}', '${app.id}')">
                                                        ê±°ì ˆ
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${job.status === 'accepted' || job.status === 'in_progress' ? `
                                <div style="margin-top: 16px; padding: 12px; background: #f0fdf4; border-radius: 8px;">
                                    <div style="font-size: 12px; color: #166534; margin-bottom: 4px;">ë‹´ë‹¹ íŒŒíŠ¸ë„ˆ</div>
                                    <div style="color: #1f2937; font-weight: 600;">
                                        ${job.partner?.name || 'íŒŒíŠ¸ë„ˆ ë°°ì •ë¨'}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // íƒ­ë³„ ì‘ì—… í•„í„°ë§
        function filterJobsByTab() {
            if (currentTab === 'all') {
                return allJobs;
            }
            return allJobs.filter(job => job.status === currentTab);
        }
        
        // íƒ­ ì „í™˜
        function switchTab(tab) {
            currentTab = tab;
            
            // íƒ­ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`tab-${tab}`).classList.add('active');
            
            // ì‘ì—… ëª©ë¡ ë‹¤ì‹œ í‘œì‹œ
            displayJobs();
        }
        
        // íƒ­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
        function updateTabCounts() {
            const counts = {
                pending: allJobs.filter(j => j.status === 'pending').length,
                accepted: allJobs.filter(j => j.status === 'accepted').length,
                in_progress: allJobs.filter(j => j.status === 'in_progress').length,
                completed: allJobs.filter(j => j.status === 'completed').length
            };
            
            // ëŒ€ê¸° ì¤‘ ì¹´ìš´íŠ¸ í‘œì‹œ
            const pendingCount = document.getElementById('pending-count');
            if (counts.pending > 0) {
                pendingCount.textContent = counts.pending;
                pendingCount.style.display = 'inline-block';
            } else {
                pendingCount.style.display = 'none';
            }
        }
        
        // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateEmptyMessage() {
            const messages = {
                all: 'ì•„ì§ ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.',
                pending: 'ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.',
                accepted: 'íŒŒíŠ¸ë„ˆê°€ ë°°ì •ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.',
                in_progress: 'ì§„í–‰ ì¤‘ì¸ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.',
                completed: 'ì™„ë£Œëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.'
            };
            
            document.getElementById('emptyDescription').textContent = messages[currentTab] || messages.all;
        }
        
        // íŒŒíŠ¸ë„ˆ ìŠ¹ì¸
        function approvePartner(jobId, applicationId, partnerId, partnerName, rating, completedJobs) {
            pendingApproval = { jobId, applicationId, partnerId };
            
            // ëª¨ë‹¬ì— ì •ë³´ í‘œì‹œ
            document.getElementById('modalPartnerName').textContent = partnerName;
            document.getElementById('modalPartnerRating').textContent = rating.toFixed(1);
            document.getElementById('modalPartnerJobs').textContent = completedJobs;
            
            // ëª¨ë‹¬ ì—´ê¸°
            document.getElementById('approveModal').classList.add('active');
        }
        
        // ìŠ¹ì¸ í™•ì¸
        async function confirmApproval() {
            if (!pendingApproval) return;
            
            try {
                // 1. ì‹ ì²­ ìŠ¹ì¸
                const { error: appError } = await window.supabaseClient
                    .from('job_applications')
                    .update({ status: 'accepted' })
                    .eq('id', pendingApproval.applicationId);
                
                if (appError) throw appError;
                
                // 2. ì‘ì—… ìƒíƒœ ì—…ë°ì´íŠ¸ ë° íŒŒíŠ¸ë„ˆ í• ë‹¹
                const { error: jobError } = await window.supabaseClient
                    .from('jobs')
                    .update({ 
                        status: 'accepted',
                        partner_id: pendingApproval.partnerId
                    })
                    .eq('id', pendingApproval.jobId);
                
                if (jobError) throw jobError;
                
                // 3. ë‹¤ë¥¸ ì‹ ì²­ ê±°ì ˆ
                const { error: rejectError } = await window.supabaseClient
                    .from('job_applications')
                    .update({ status: 'rejected' })
                    .eq('job_id', pendingApproval.jobId)
                    .neq('id', pendingApproval.applicationId)
                    .eq('status', 'pending');
                
                if (rejectError) console.error('ë‹¤ë¥¸ ì‹ ì²­ ê±°ì ˆ ì˜¤ë¥˜:', rejectError);
                
                alert('íŒŒíŠ¸ë„ˆê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeModal();
                await loadJobs();
                
            } catch (error) {
                console.error('ìŠ¹ì¸ ì˜¤ë¥˜:', error);
                alert('ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // íŒŒíŠ¸ë„ˆ ê±°ì ˆ
        async function rejectPartner(jobId, applicationId) {
            if (!confirm('ì´ íŒŒíŠ¸ë„ˆì˜ ì‹ ì²­ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const { error } = await window.supabaseClient
                    .from('job_applications')
                    .update({ status: 'rejected' })
                    .eq('id', applicationId);
                
                if (error) throw error;
                
                alert('ì‹ ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadJobs();
                
            } catch (error) {
                console.error('ê±°ì ˆ ì˜¤ë¥˜:', error);
                alert('ê±°ì ˆ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('approveModal').classList.remove('active');
            pendingApproval = null;
        }
        
        // ìƒíƒœ í…ìŠ¤íŠ¸
        function getStatusText(status) {
            const texts = {
                pending: 'ëŒ€ê¸° ì¤‘',
                accepted: 'íŒŒíŠ¸ë„ˆ ë°°ì •',
                in_progress: 'ì§„í–‰ ì¤‘',
                completed: 'ì™„ë£Œ',
                cancelled: 'ì·¨ì†Œë¨'
            };
            return texts[status] || status;
        }
        
        // ì‘ì—… ìœ í˜• í…ìŠ¤íŠ¸
        function getJobTypeText(type) {
            const texts = {
                regular: 'ì •ê¸° ì²­ì†Œ',
                deep: 'ëŒ€ì²­ì†Œ',
                move_in: 'ì…ì£¼ ì²­ì†Œ',
                move_out: 'ì´ì‚¬ ì²­ì†Œ',
                emergency: 'ê¸´ê¸‰ ì²­ì†Œ'
            };
            return texts[type] || type;
        }
        
        // ì‹œê°„ëŒ€ í…ìŠ¤íŠ¸
        function getTimeText(time) {
            const texts = {
                morning: 'ì˜¤ì „',
                afternoon: 'ì˜¤í›„',
                evening: 'ì €ë…',
                flexible: 'ì‹œê°„ ë¬´ê´€'
            };
            return texts[time] || time;
        }
        
        // ê¸´ê¸‰ë„ í…ìŠ¤íŠ¸
        function getUrgencyText(urgency) {
            const texts = {
                normal: 'ë³´í†µ',
                urgent: 'ê¸´ê¸‰',
                very_urgent: 'ë§¤ìš° ê¸´ê¸‰'
            };
            return texts[urgency] || urgency;
        }
        
        // ë¡œë”© í‘œì‹œ
        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'flex' : 'none';
            document.getElementById('jobsContent').style.display = show ? 'none' : 'block';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            // í—¤ë”/í‘¸í„° ë¡œë“œ
            loadComponent('header', '../components/header.html');
            loadComponent('footer', '../components/footer.html');
            
            // í˜ì´ì§€ ì´ˆê¸°í™”
            initializePage();
        });
        
        // ì»´í¬ë„ŒíŠ¸ ë¡œë“œ í•¨ìˆ˜
        async function loadComponent(id, path) {
            try {
                const response = await fetch(path);
                const html = await response.text();
                document.getElementById(id).innerHTML = html;
            } catch (error) {
                console.error(`${id} ë¡œë“œ ì˜¤ë¥˜:`, error);
            }
        }
    </script>
</body>
</html>