<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linky - í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</title>
    
        <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    
    
    <style>
        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f7fafc;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #22c55e;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        
        .section h3 {
            color: #1f2937;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #22c55e;
            color: white;
        }
        
        .btn-primary:hover {
            background: #16a34a;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .status.success {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .account-info {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        
        .account-info h4 {
            margin-bottom: 10px;
            color: #374151;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Linky í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± ë„êµ¬</h1>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <a href="index.html" style="color: #22c55e; text-decoration: none; font-weight: 600;">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        
        <div class="section">
            <h3>ğŸ“‹ í˜„ì¬ ìƒì„±ëœ í…ŒìŠ¤íŠ¸ ê³„ì •</h3>
            <div id="existingAccounts">
                <div class="account-info">
                    <h4>ğŸ¢ í…ŒìŠ¤íŠ¸ ì‚¬ì—…ì ê³„ì •</h4>
                    <div>ì´ë©”ì¼: business@test.com</div>
                    <div>ë¹„ë°€ë²ˆí˜¸: test1234</div>
                    <div>ì´ë¦„: í…ŒìŠ¤íŠ¸ì¹´í˜</div>
                    <div>ìƒíƒœ: ìŠ¹ì¸ ì™„ë£Œ</div>
                </div>
                
                <div class="account-info">
                    <h4>ğŸ¤ í…ŒìŠ¤íŠ¸ íŒŒíŠ¸ë„ˆ ê³„ì •</h4>
                    <div>ì´ë©”ì¼: partner@test.com</div>
                    <div>ë¹„ë°€ë²ˆí˜¸: test1234</div>
                    <div>ì´ë¦„: ê¹€íŒŒíŠ¸ë„ˆ</div>
                    <div>ìƒíƒœ: ìŠ¹ì¸ ì™„ë£Œ</div>
                </div>
                
                <div class="account-info">
                    <h4>âš™ï¸ í…ŒìŠ¤íŠ¸ ê´€ë¦¬ì ê³„ì •</h4>
                    <div>ì´ë©”ì¼: admin@test.com</div>
                    <div>ë¹„ë°€ë²ˆí˜¸: test1234</div>
                    <div>ì´ë¦„: ê´€ë¦¬ì</div>
                    <div>ìƒíƒœ: í™œì„±</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ‘¥ ì‚¬ìš©ì ê³„ì • ìƒì„±</h3>
            <button onclick="createTestUsers()" class="btn btn-primary">
                í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±
            </button>
            <div id="userStatus"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ¢ í…ŒìŠ¤íŠ¸ ê³µê°„ ìƒì„±</h3>
            <button onclick="createTestSpaces()" class="btn btn-primary">
                í…ŒìŠ¤íŠ¸ ê³µê°„ ìƒì„±
            </button>
            <div id="spaceStatus"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ’¼ í…ŒìŠ¤íŠ¸ ì‘ì—… ìƒì„±</h3>
            <button onclick="createTestJobs()" class="btn btn-primary">
                í…ŒìŠ¤íŠ¸ ì‘ì—… ìƒì„±
            </button>
            <div id="jobStatus"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ—‘ï¸ ë°ì´í„° ê´€ë¦¬</h3>
            <button onclick="clearTestData()" class="btn btn-danger">
                í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
            </button>
            <button onclick="checkCurrentData()" class="btn btn-secondary">
                í˜„ì¬ ë°ì´í„° í™•ì¸
            </button>
            <div id="dataStatus"></div>
        </div>
    </div>

    <!-- Supabase ì„¤ì • -->
    <script src="supabase-config.js"></script>
    <script>
        // í…ŒìŠ¤íŠ¸ ê³„ì • ì •ë³´
        const testAccounts = {
            business: {
                email: 'business@test.com',
                password: 'test1234',
                name: 'í…ŒìŠ¤íŠ¸ì¹´í˜',
                phone: '010-1234-5678',
                type: 'business',
                status: 'approved',
                business: {
                    businessName: 'ê°•ë‚¨ í…ŒìŠ¤íŠ¸ì¹´í˜',
                    businessNumber: '123-45-67890',
                    businessType: 'studyroom',
                    businessAddress: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…ŒìŠ¤íŠ¸ë™',
                    representativeName: 'ê¹€ì‚¬ì¥',
                    bankAccount: {
                        bank: 'êµ­ë¯¼ì€í–‰',
                        accountNumber: '1234-5678-9012',
                        accountHolder: 'ê¹€ì‚¬ì¥'
                    },
                    monthlyUsage: 15,
                    totalSpent: 270000,
                    spaceCount: 2
                }
            },
            partner: {
                email: 'partner@test.com',
                password: 'test1234',
                name: 'ê¹€íŒŒíŠ¸ë„ˆ',
                phone: '010-9876-5432',
                type: 'partner',
                status: 'approved',
                partner: {
                    realName: 'ê¹€ì •ë¦¬',
                    workInfo: {
                        areas: ['ê°•ë‚¨êµ¬', 'ì„œì´ˆêµ¬'],
                        availableTimes: {
                            weekday: ['morning', 'afternoon', 'evening'],
                            weekend: ['morning', 'afternoon']
                        },
                        transportation: 'public',
                        experience: '1year'
                    },
                    performance: {
                        rating: 4.8,
                        completedJobs: 45,
                        cancelledJobs: 1,
                        totalEarnings: 540000,
                        thisMonthEarnings: 120000,
                        level: 'silver'
                    },
                    bankAccount: {
                        bank: 'ì¹´ì¹´ì˜¤ë±…í¬',
                        accountNumber: '3333-4444-5555',
                        accountHolder: 'ê¹€ì •ë¦¬'
                    }
                }
            },
            admin: {
                email: 'admin@test.com',
                password: 'test1234',
                name: 'ê´€ë¦¬ì',
                phone: '010-0000-0000',
                type: 'admin',
                status: 'approved'
            }
        };

        // í…ŒìŠ¤íŠ¸ ê³µê°„ ë°ì´í„°
        const testSpaces = [
            {
                name: 'ê°•ë‚¨ ìŠ¤í„°ë””ë£¸ A',
                type: 'studyroom',
                size: 15,
                capacity: 6,
                address: {
                    fullAddress: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…ŒìŠ¤íŠ¸ë™ 123-45 3ì¸µ',
                    sido: 'ì„œìš¸ì‹œ',
                    sigungu: 'ê°•ë‚¨êµ¬',
                    dong: 'í…ŒìŠ¤íŠ¸ë™',
                    detail: 'í…ŒìŠ¤íŠ¸ë¹Œë”© 3ì¸µ 301í˜¸',
                    postalCode: '06120',
                    coordinates: { lat: 37.5172, lng: 127.0286 }
                },
                accessInfo: {
                    entrancePassword: '1234',
                    parkingAvailable: true,
                    parkingInfo: 'ê±´ë¬¼ ì§€í•˜ 1ì¸µ',
                    publicTransport: 'ê°•ë‚¨ì—­ 5ë²ˆ ì¶œêµ¬ ë„ë³´ 5ë¶„'
                },
                amenities: {
                    hasToilet: true,
                    toiletLocation: 'same',
                    hasSink: true,
                    hasKitchen: false,
                    hasAircon: true,
                    hasHeating: true,
                    hasWifi: true,
                    hasCCTV: true
                },
                status: 'active'
            },
            {
                name: 'ì„œì´ˆ íŒŒí‹°ë£¸ B',
                type: 'partyroom',
                size: 20,
                capacity: 10,
                address: {
                    fullAddress: 'ì„œìš¸ì‹œ ì„œì´ˆêµ¬ í…ŒìŠ¤íŠ¸ë¡œ 456 2ì¸µ',
                    sido: 'ì„œìš¸ì‹œ',
                    sigungu: 'ì„œì´ˆêµ¬',
                    dong: 'í…ŒìŠ¤íŠ¸ë™',
                    detail: 'íŒŒí‹°ë¹Œë”© 2ì¸µ',
                    postalCode: '06520'
                },
                status: 'active'
            }
        ];

        // Firebase ì´ˆê¸°í™” í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof window.supabaseClient === 'undefined') {
                    showStatus('dataStatus', 'Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                } else {
                    showStatus('dataStatus', 'Firebase ì—°ê²° ì™„ë£Œ', 'success');
                    checkCurrentData();
                }
            }, 1000);
        });

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatus(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoading(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="status"><span class="loading"></span>${message}</div>`;
        }

        // í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„±
        async function createTestUsers() {
            showLoading('userStatus', 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ì¤‘...');
            
            try {
                for (const [type, userData] of Object.entries(testAccounts)) {
                    try {
                        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
                        const existingUser = await checkUserExists(userData.email);
                        if (existingUser) {
                            console.log(`${type} ì‚¬ìš©ì ì´ë¯¸ ì¡´ì¬:`, userData.email);
                            continue;
                        }

                        // ì‚¬ìš©ì ìƒì„±
                        const userCredential = await auth.createUserWithEmailAndPassword(
                            userData.email, 
                            userData.password
                        );
                        
                        // Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥
                        const userDoc = {
                            uid: userCredential.user.uid,
                            email: userData.email,
                            name: userData.name,
                            phone: userData.phone,
                            type: userData.type,
                            status: userData.status,
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString()
                        };

                        // íƒ€ì…ë³„ ì¶”ê°€ ì •ë³´
                        if (userData.business) {
                            userDoc.business = userData.business;
                        }
                        if (userData.partner) {
                            userDoc.partner = userData.partner;
                        }

                        await db.collection('users').doc(userCredential.user.uid).set(userDoc);
                        
                        console.log(`${type} ì‚¬ìš©ì ìƒì„± ì™„ë£Œ:`, userData.email);
                        
                        // ë¡œê·¸ì•„ì›ƒ (ë‹¤ìŒ ì‚¬ìš©ì ìƒì„±ì„ ìœ„í•´)
                        await auth.signOut();
                        
                    } catch (error) {
                        if (error.code === 'auth/email-already-in-use') {
                            console.log(`${type} ì‚¬ìš©ì ì´ë¯¸ ì¡´ì¬:`, userData.email);
                        } else {
                            throw error;
                        }
                    }
                }
                
                showStatus('userStatus', 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ìƒì„± ì™„ë£Œ!', 'success');
                
            } catch (error) {
                console.error('ì‚¬ìš©ì ìƒì„± ì˜¤ë¥˜:', error);
                showStatus('userStatus', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ì‚¬ìš©ì ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        async function checkUserExists(email) {
            try {
                const snapshot = await db.collection('users')
                    .where('email', '==', email)
                    .get();
                return !snapshot.empty;
            } catch (error) {
                return false;
            }
        }

        // í…ŒìŠ¤íŠ¸ ê³µê°„ ìƒì„±
        async function createTestSpaces() {
            showLoading('spaceStatus', 'í…ŒìŠ¤íŠ¸ ê³µê°„ ìƒì„± ì¤‘...');
            
            try {
                // ì‚¬ì—…ì ê³„ì • ì°¾ê¸°
                const businessSnapshot = await db.collection('users')
                    .where('email', '==', 'business@test.com')
                    .get();
                
                if (businessSnapshot.empty) {
                    throw new Error('í…ŒìŠ¤íŠ¸ ì‚¬ì—…ì ê³„ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‚¬ìš©ìë¥¼ ìƒì„±í•˜ì„¸ìš”.');
                }
                
                const businessUser = businessSnapshot.docs[0];
                const businessId = businessUser.id;
                
                // ê³µê°„ ìƒì„±
                for (const spaceData of testSpaces) {
                    const space = {
                        ...spaceData,
                        ownerId: businessId,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        stats: {
                            totalJobs: 0,
                            thisMonthJobs: 0,
                            averageRating: 0
                        }
                    };
                    
                    await db.collection('spaces').add(space);
                }
                
                showStatus('spaceStatus', 'í…ŒìŠ¤íŠ¸ ê³µê°„ ìƒì„± ì™„ë£Œ!', 'success');
                
            } catch (error) {
                console.error('ê³µê°„ ìƒì„± ì˜¤ë¥˜:', error);
                showStatus('spaceStatus', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ ì‘ì—… ìƒì„±
        async function createTestJobs() {
            showLoading('jobStatus', 'í…ŒìŠ¤íŠ¸ ì‘ì—… ìƒì„± ì¤‘...');
            
            try {
                // ì‚¬ì—…ìì™€ ê³µê°„ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const businessSnapshot = await db.collection('users')
                    .where('email', '==', 'business@test.com')
                    .get();
                
                const spacesSnapshot = await db.collection('spaces')
                    .limit(1)
                    .get();
                
                if (businessSnapshot.empty || spacesSnapshot.empty) {
                    throw new Error('í…ŒìŠ¤íŠ¸ ì‚¬ìš©ìë‚˜ ê³µê°„ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìƒì„±í•˜ì„¸ìš”.');
                }
                
                const businessId = businessSnapshot.docs[0].id;
                const spaceId = spacesSnapshot.docs[0].id;
                
                // ë‹¤ì–‘í•œ ìƒíƒœì˜ ì‘ì—… ìƒì„±
                const jobStatuses = ['pending', 'matched', 'completed'];
                
                for (let i = 0; i < 3; i++) {
                    const now = new Date();
                    const requestDate = new Date(now.getTime() + (i * 24 * 60 * 60 * 1000));
                    
                    const jobData = {
                        jobId: `JOB-${now.toISOString().split('T')[0].replace(/-/g, '')}-${Math.random().toString(36).substr(2, 6).toUpperCase()}`,
                        spaceId: spaceId,
                        businessId: businessId,
                        partnerId: jobStatuses[i] !== 'pending' ? 'partner_id_placeholder' : null,
                        status: jobStatuses[i],
                        
                        schedule: {
                            requestedDate: requestDate.toISOString().split('T')[0],
                            requestedTime: '14:00',
                            urgency: 'normal',
                            estimatedDuration: 30,
                            flexibleTime: true
                        },
                        
                        services: {
                            basic: {
                                selected: true,
                                price: 12000,
                                details: "ê¸°ë³¸ ì •ë¦¬ì •ëˆ, ì“°ë ˆê¸° ì²˜ë¦¬, ì†Œëª¨í’ˆ ë³´ì¶©"
                            },
                            floor: {
                                selected: i % 2 === 0,
                                price: i % 2 === 0 ? 3000 : 0,
                                size: "15í‰ ì´í•˜"
                            },
                            dishes: {
                                selected: false,
                                price: 0,
                                quantity: null
                            },
                            toilet: {
                                selected: i === 2,
                                price: i === 2 ? 3000 : 0,
                                count: i === 2 ? 1 : 0
                            }
                        },
                        
                        pricing: {
                            basePrice: 12000,
                            additionalServices: (i % 2 === 0 ? 3000 : 0) + (i === 2 ? 3000 : 0),
                            urgencyFee: 0,
                            discount: 0,
                            totalPrice: 12000 + (i % 2 === 0 ? 3000 : 0) + (i === 2 ? 3000 : 0),
                            commission: Math.floor((12000 + (i % 2 === 0 ? 3000 : 0) + (i === 2 ? 3000 : 0)) * 0.2),
                            partnerEarnings: Math.floor((12000 + (i % 2 === 0 ? 3000 : 0) + (i === 2 ? 3000 : 0)) * 0.8)
                        },
                        
                        matching: {
                            requestedAt: new Date().toISOString(),
                            notifiedPartners: [],
                            rejectedBy: [],
                            acceptedAt: jobStatuses[i] !== 'pending' ? new Date().toISOString() : null,
                            matchingAttempts: 1
                        },
                        
                        execution: null,
                        evidence: {
                            beforePhotos: [],
                            afterPhotos: [],
                            additionalPhotos: []
                        },
                        
                        review: {
                            businessRating: null,
                            businessComment: null,
                            partnerRating: null,
                            partnerComment: null,
                            reviewedAt: null
                        },
                        
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        completedAt: jobStatuses[i] === 'completed' ? new Date().toISOString() : null,
                        cancelledAt: null,
                        cancelReason: null
                    };
                    
                    await db.collection('jobs').add(jobData);
                }
                
                showStatus('jobStatus', 'í…ŒìŠ¤íŠ¸ ì‘ì—… ìƒì„± ì™„ë£Œ!', 'success');
                
            } catch (error) {
                console.error('ì‘ì—… ìƒì„± ì˜¤ë¥˜:', error);
                showStatus('jobStatus', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í˜„ì¬ ë°ì´í„° í™•ì¸
        async function checkCurrentData() {
            showLoading('dataStatus', 'ë°ì´í„° í™•ì¸ ì¤‘...');
            
            try {
                const [usersSnapshot, spacesSnapshot, jobsSnapshot] = await Promise.all([
                    db.collection('users').get(),
                    db.collection('spaces').get(),
                    db.collection('jobs').get()
                ]);
                
                const users = {};
                usersSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (!users[data.type]) users[data.type] = 0;
                    users[data.type]++;
                });
                
                const message = `
                    ğŸ“Š í˜„ì¬ ë°ì´í„° í˜„í™©:<br>
                    ğŸ‘¥ ì‚¬ìš©ì: ${usersSnapshot.size}ëª… (ì‚¬ì—…ì: ${users.business || 0}, íŒŒíŠ¸ë„ˆ: ${users.partner || 0}, ê´€ë¦¬ì: ${users.admin || 0})<br>
                    ğŸ¢ ê³µê°„: ${spacesSnapshot.size}ê°œ<br>
                    ğŸ’¼ ì‘ì—…: ${jobsSnapshot.size}ê°œ
                `;
                
                showStatus('dataStatus', message, 'success');
                
            } catch (error) {
                console.error('ë°ì´í„° í™•ì¸ ì˜¤ë¥˜:', error);
                showStatus('dataStatus', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ
        async function clearTestData() {
            if (!confirm('ì •ë§ ëª¨ë“  í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            showLoading('dataStatus', 'í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì¤‘...');
            
            try {
                // ëª¨ë“  ì»¬ë ‰ì…˜ì˜ ë¬¸ì„œ ì‚­ì œ
                const collections = ['users', 'spaces', 'jobs'];
                
                for (const collectionName of collections) {
                    const snapshot = await db.collection(collectionName).get();
                    const batch = db.batch();
                    
                    snapshot.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    if (snapshot.docs.length > 0) {
                        await batch.commit();
                    }
                }
                
                showStatus('dataStatus', 'í…ŒìŠ¤íŠ¸ ë°ì´í„° ì‚­ì œ ì™„ë£Œ!', 'success');
                
            } catch (error) {
                console.error('ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
                showStatus('dataStatus', `ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>