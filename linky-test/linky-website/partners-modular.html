<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RYYX6LYN2B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RYYX6LYN2B');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linky 파트너 - 자유로운 시간에 수익 창출</title>
    
        <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    
    
    <!-- Supabase 설정 -->
    <script src="supabase-config.js"></script>
    
    <!-- 공통 스타일 -->
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/components.css">
    
    <!-- 페이지별 스타일 -->
    <style>
        /* 히어로 섹션 */
        .hero-section {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 100px 0;
            text-align: center;
        }

        .hero-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            animation: fadeIn 0.8s ease-out;
        }

        .hero-subtitle {
            font-size: 24px;
            margin-bottom: 40px;
            opacity: 0.9;
            animation: fadeIn 0.8s ease-out 0.2s backwards;
        }

        /* 수익 계산기 */
        .calculator-container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: -60px auto 60px;
            position: relative;
            z-index: 10;
        }

        .calculator-input {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .calculator-slider {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
        }

        .calculator-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: #22c55e;
            border-radius: 50%;
            cursor: pointer;
        }

        .calculator-result {
            text-align: center;
            padding: 30px;
            background: #f0fdf4;
            border-radius: 8px;
            margin-top: 20px;
        }

        .result-amount {
            font-size: 48px;
            font-weight: bold;
            color: #22c55e;
            margin-bottom: 10px;
        }

        /* 혜택 섹션 */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .benefit-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s;
        }

        .benefit-card:hover {
            transform: translateY(-5px);
        }

        .benefit-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        /* FAQ 섹션 */
        .faq-item {
            background: white;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .faq-question {
            padding: 20px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .faq-question:hover {
            background: #f8fafc;
        }

        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s, padding 0.3s;
        }

        .faq-item.active .faq-answer {
            padding: 20px;
            max-height: 500px;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        /* 후기 섹션 */
        .reviews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .review-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .review-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .review-avatar {
            width: 50px;
            height: 50px;
            background: #22c55e;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 20px;
        }

        .review-rating {
            color: #fbbf24;
            margin-bottom: 10px;
        }

        /* 파트너 대시보드 */
        .partner-dashboard {
            padding: 40px 0;
        }

        .earnings-card {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .earnings-amount {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .job-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .job-item {
            padding: 20px;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .job-item:hover {
            background: #f8fafc;
        }

        .job-item:last-child {
            border-bottom: none;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }
            
            .hero-subtitle {
                font-size: 18px;
            }
            
            .calculator-container {
                padding: 30px 20px;
                margin: -40px 20px 40px;
            }
            
            .reviews-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 헤더 컴포넌트 -->
    <div id="header-root"></div>

    <!-- 메인 컨텐츠 -->
    <main id="mainContent">
        <!-- 게스트 뷰 (로그인 전) -->
        <div id="guestView">
            <!-- 히어로 섹션 -->
            <section class="hero-section">
                <div class="section-container">
                    <h1 class="hero-title">원하는 시간에, 원하는 만큼</h1>
                    <p class="hero-subtitle">평균 시급 3만원의 새로운 부수입 기회</p>
                    <button class="btn" style="background: white; color: #22c55e; font-size: 18px; padding: 15px 30px;" onclick="authModal.openSignupSelect()">
                        파트너 지원하기
                    </button>
                </div>
            </section>

            <!-- 수익 계산기 -->
            <section>
                <div class="calculator-container">
                    <h3 style="text-align: center; margin-bottom: 30px; color: #1f2937;">
                        예상 수익 계산하기
                    </h3>
                    <div>
                        <label style="display: block; margin-bottom: 15px; color: #4b5563;">
                            일주일에 몇 번 정도 활동하실 예정인가요?
                        </label>
                        <div class="calculator-input">
                            <input type="range" class="calculator-slider" id="weeklyCount" 
                                   min="1" max="20" value="8" oninput="calculateEarnings()">
                            <span id="weeklyCountDisplay" style="font-size: 24px; font-weight: bold; color: #22c55e; min-width: 60px;">
                                8회
                            </span>
                        </div>
                    </div>
                    <div class="calculator-result">
                        <div class="result-amount" id="monthlyEarnings">480,000원</div>
                        <div style="color: #6b7280;">예상 월 수익</div>
                        <div style="margin-top: 10px; font-size: 14px; color: #9ca3af;">
                            * 건당 평균 15,000원, 주당 <span id="weeklyCountText">8</span>회 기준
                        </div>
                    </div>
                </div>
            </section>

            <!-- 혜택 섹션 -->
            <section id="benefits" class="section">
                <div class="section-container">
                    <div class="section-header">
                        <h2 class="section-title">파트너 혜택</h2>
                        <p class="section-subtitle">Linky 파트너가 되면 이런 점이 좋아요</p>
                    </div>
                    
                    <div class="benefits-grid">
                        <div class="benefit-card">
                            <div class="benefit-icon">💰</div>
                            <h3>높은 수익</h3>
                            <p>평균 25분 작업으로 12,000원 이상 수익 (시급 3만원 수준)</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-icon">🕐</div>
                            <h3>자유로운 시간</h3>
                            <p>원하는 시간, 원하는 지역에서만 자유롭게 활동</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-icon">🎯</div>
                            <h3>간단한 작업</h3>
                            <p>전문 청소가 아닌 간단한 정리 작업 (평균 10-25분)</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-icon">🚀</div>
                            <h3>즉시 시작</h3>
                            <p>복잡한 면접 없이 간단한 인증 후 바로 시작</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-icon">📱</div>
                            <h3>스마트한 관리</h3>
                            <p>모바일로 모든 것을 간편하게 처리</p>
                        </div>
                        <div class="benefit-card">
                            <div class="benefit-icon">🏆</div>
                            <h3>성과 보상</h3>
                            <p>우수 파트너 추가 인센티브 및 혜택 제공</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FAQ 섹션 -->
            <section id="faq" class="section" style="background: #f8fafc;">
                <div class="section-container">
                    <div class="section-header">
                        <h2 class="section-title">자주 묻는 질문</h2>
                        <p class="section-subtitle">파트너님들이 궁금해하시는 내용들</p>
                    </div>
                    
                    <div style="max-width: 800px; margin: 0 auto;">
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                <span>어떤 작업을 하게 되나요?</span>
                                <span class="faq-icon">▼</span>
                            </div>
                            <div class="faq-answer">
                                <p>주로 스터디카페, 파티룸 등의 간단한 정리 작업을 하게 됩니다. 
                                테이블 정리, 의자 배치, 쓰레기 수거, 소모품 보충 등 
                                10-25분 내에 끝나는 간단한 작업들입니다.</p>
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                <span>수익은 언제 정산되나요?</span>
                                <span class="faq-icon">▼</span>
                            </div>
                            <div class="faq-answer">
                                <p>작업 완료 후 고객 확인이 끝나면 즉시 정산 가능합니다. 
                                주 단위로 일괄 정산하거나, 원하실 때 언제든 출금 신청할 수 있습니다.</p>
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                <span>특별한 자격이 필요한가요?</span>
                                <span class="faq-icon">▼</span>
                            </div>
                            <div class="faq-answer">
                                <p>특별한 자격은 필요하지 않습니다. 
                                만 18세 이상이면 누구나 지원 가능하며, 
                                간단한 온라인 교육 후 바로 시작할 수 있습니다.</p>
                            </div>
                        </div>
                        
                        <div class="faq-item">
                            <div class="faq-question" onclick="toggleFaq(this)">
                                <span>장비나 도구를 준비해야 하나요?</span>
                                <span class="faq-icon">▼</span>
                            </div>
                            <div class="faq-answer">
                                <p>기본적인 청소 도구는 공간에 구비되어 있습니다. 
                                파트너님은 스마트폰만 있으면 됩니다. 
                                필요시 간단한 청소 도구를 지급해드립니다.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 후기 섹션 -->
            <section id="reviews" class="section">
                <div class="section-container">
                    <div class="section-header">
                        <h2 class="section-title">파트너 후기</h2>
                        <p class="section-subtitle">실제 파트너님들의 생생한 이야기</p>
                    </div>
                    
                    <div class="reviews-grid">
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-avatar">김OO</div>
                                <div>
                                    <div class="review-rating">⭐⭐⭐⭐⭐</div>
                                    <div style="color: #6b7280;">강남구 활동 6개월</div>
                                </div>
                            </div>
                            <p style="line-height: 1.6;">
                                "퇴근 후 시간을 활용해서 월 100만원 정도 추가 수익을 얻고 있어요. 
                                작업도 간단하고, 원하는 시간에만 할 수 있어서 정말 만족합니다."
                            </p>
                        </div>
                        
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-avatar">박OO</div>
                                <div>
                                    <div class="review-rating">⭐⭐⭐⭐⭐</div>
                                    <div style="color: #6b7280;">서초구 활동 3개월</div>
                                </div>
                            </div>
                            <p style="line-height: 1.6;">
                                "대학생인데 공강 시간을 활용하기 좋아요. 
                                한 번에 15,000원 정도 벌 수 있고, 일도 어렵지 않아서 추천해요!"
                            </p>
                        </div>
                        
                        <div class="review-card">
                            <div class="review-header">
                                <div class="review-avatar">이OO</div>
                                <div>
                                    <div class="review-rating">⭐⭐⭐⭐⭐</div>
                                    <div style="color: #6b7280;">송파구 활동 1년</div>
                                </div>
                            </div>
                            <p style="line-height: 1.6;">
                                "주부인데 아이 학교 보낸 후 오전 시간을 활용하고 있어요. 
                                시간도 자유롭고 수익도 괜찮아서 정말 좋습니다."
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- CTA 섹션 -->
            <section class="section" style="background: #f0fdf4;">
                <div class="section-container text-center">
                    <h2 class="section-title">지금 시작하세요</h2>
                    <p class="section-subtitle" style="margin-bottom: 30px;">
                        3분 만에 지원하고, 내일부터 수익 창출
                    </p>
                    <button class="btn btn-primary" style="font-size: 20px; padding: 15px 40px;" onclick="authModal.openSignupSelect()">
                        파트너 지원하기
                    </button>
                </div>
            </section>
        </div>

        <!-- 파트너 대시보드 (로그인 후) -->
        <div id="partnerDashboard" style="display: none;">
            <!-- 대시보드 내용은 JavaScript로 동적 생성 -->
        </div>
    </main>

    <!-- 푸터 컴포넌트 -->
    <div id="footer-root"></div>

    <!-- 인증 모달 -->
    <script src="auth-modal.js"></script>
    
    <!-- 공통 스크립트 -->
    <script src="js/utils.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/auth-utils.js"></script>
    <script src="components/header.js"></script>
    <script src="components/footer.js"></script>
    
    <!-- 페이지별 스크립트 -->
    <script>
        let currentUser = null;
        let availableJobs = [];
        let myJobs = [];

        // 페이지 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 헤더 컴포넌트 초기화
            window.headerComponent = new HeaderComponent({
                showPartnerMenu: true,
                currentPage: 'partner'
            });
            
            // 푸터 컴포넌트 초기화
            new FooterComponent();
            
            // 인증 상태 확인
            checkAuthStatus().then(({ isAuthenticated, user }) => {
                if (isAuthenticated && user && user.type === 'partner') {
                    currentUser = user;
                    showPartnerDashboard();
                } else {
                    showGuestView();
                }
            });
        });

        // 수익 계산기
        function calculateEarnings() {
            const weeklyCount = document.getElementById('weeklyCount').value;
            const monthlyEarnings = weeklyCount * 4 * 15000;
            
            document.getElementById('weeklyCountDisplay').textContent = weeklyCount + '회';
            document.getElementById('weeklyCountText').textContent = weeklyCount;
            document.getElementById('monthlyEarnings').textContent = monthlyEarnings.toLocaleString() + '원';
        }

        // FAQ 토글
        function toggleFaq(element) {
            const faqItem = element.parentElement;
            faqItem.classList.toggle('active');
        }

        // 게스트 뷰 표시
        function showGuestView() {
            document.getElementById('guestView').style.display = 'block';
            document.getElementById('partnerDashboard').style.display = 'none';
        }

        // 파트너 대시보드 표시
        async function showPartnerDashboard() {
            document.getElementById('guestView').style.display = 'none';
            document.getElementById('partnerDashboard').style.display = 'block';
            
            // 데이터 로드
            await loadPartnerData();
            
            // 대시보드 렌더링
            renderPartnerDashboard();
        }

        // 파트너 데이터 로드
        async function loadPartnerData() {
            try {
                // 이용 가능한 작업 로드
                const availableSnapshot = await db.collection('jobs')
                    .where('status', '==', 'pending')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                availableJobs = [];
                availableSnapshot.forEach(doc => {
                    availableJobs.push({ id: doc.id, ...doc.data() });
                });
                
                // 내 작업 로드
                const mySnapshot = await db.collection('jobs')
                    .where('partnerId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                myJobs = [];
                mySnapshot.forEach(doc => {
                    myJobs.push({ id: doc.id, ...doc.data() });
                });
            } catch (error) {
                console.error('파트너 데이터 로드 오류:', error);
            }
        }

        // 파트너 대시보드 렌더링
        function renderPartnerDashboard() {
            const dashboard = document.getElementById('partnerDashboard');
            
            // 이번 달 수익 계산
            const thisMonthEarnings = myJobs
                .filter(job => job.status === 'completed')
                .reduce((sum, job) => sum + (job.pricing?.partnerEarnings || 0), 0);
            
            dashboard.innerHTML = `
                <section class="partner-dashboard">
                    <div class="section-container">
                        <h1 style="font-size: 32px; font-weight: bold; color: #1f2937; margin-bottom: 30px; text-align: center;">
                            안녕하세요, ${currentUser.name || '파트너'}님! 👋
                        </h1>
                        
                        <!-- 수익 카드 -->
                        <div class="earnings-card">
                            <div style="font-size: 16px; opacity: 0.9; margin-bottom: 5px;">이번 달 수익</div>
                            <div class="earnings-amount">${thisMonthEarnings.toLocaleString()}원</div>
                            <div style="font-size: 14px; opacity: 0.8;">
                                완료된 작업: ${myJobs.filter(job => job.status === 'completed').length}건
                            </div>
                        </div>
                        
                        <!-- 이용 가능한 작업 -->
                        <div style="margin-bottom: 40px;">
                            <h2 style="font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 20px;">
                                이용 가능한 작업
                            </h2>
                            ${renderAvailableJobs()}
                        </div>
                        
                        <!-- 내 작업 -->
                        <div>
                            <h2 style="font-size: 24px; font-weight: bold; color: #1f2937; margin-bottom: 20px;">
                                내 작업
                            </h2>
                            ${renderMyJobs()}
                        </div>
                    </div>
                </section>
            `;
        }

        // 이용 가능한 작업 렌더링
        function renderAvailableJobs() {
            if (availableJobs.length === 0) {
                return `
                    <div style="text-align: center; padding: 40px; background: #f8fafc; border-radius: 12px;">
                        <p style="color: #6b7280;">현재 이용 가능한 작업이 없습니다.</p>
                    </div>
                `;
            }

            return `
                <div class="job-list">
                    ${availableJobs.map(job => `
                        <div class="job-item" onclick="acceptJob('${job.id}')">
                            <div>
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    ${job.spaceInfo?.name || '공간 정보 없음'}
                                </div>
                                <div style="font-size: 14px; color: #6b7280;">
                                    ${job.schedule?.requestedDate} ${job.schedule?.requestedTime} · 
                                    ${job.spaceInfo?.address?.sigungu || '위치 정보 없음'}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 18px; font-weight: bold; color: #22c55e;">
                                    ${(job.pricing?.partnerEarnings || 0).toLocaleString()}원
                                </div>
                                <button class="btn btn-small btn-primary" style="margin-top: 5px;">
                                    수락하기
                                </button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 내 작업 렌더링
        function renderMyJobs() {
            if (myJobs.length === 0) {
                return `
                    <div style="text-align: center; padding: 40px; background: #f8fafc; border-radius: 12px;">
                        <p style="color: #6b7280;">아직 수락한 작업이 없습니다.</p>
                    </div>
                `;
            }

            return `
                <div class="job-list">
                    ${myJobs.map(job => {
                        const statusConfig = getStatusConfig(job.status);
                        return `
                            <div class="job-item">
                                <div>
                                    <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                        ${job.spaceInfo?.name || '공간 정보 없음'}
                                    </div>
                                    <div style="font-size: 14px; color: #6b7280;">
                                        ${job.schedule?.requestedDate} ${job.schedule?.requestedTime}
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <span style="background: ${statusConfig.bg}; color: ${statusConfig.color}; padding: 4px 12px; border-radius: 12px; font-size: 14px; font-weight: 600;">
                                        ${statusConfig.text}
                                    </span>
                                    <div style="margin-top: 5px; font-weight: bold; color: #22c55e;">
                                        ${(job.pricing?.partnerEarnings || 0).toLocaleString()}원
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // 상태 설정 가져오기
        function getStatusConfig(status) {
            const configs = {
                matched: { text: '매칭됨', color: '#1e40af', bg: '#dbeafe' },
                in_progress: { text: '진행 중', color: '#3730a3', bg: '#e0e7ff' },
                completed: { text: '완료', color: '#065f46', bg: '#d1fae5' },
                cancelled: { text: '취소', color: '#991b1b', bg: '#fee2e2' }
            };
            return configs[status] || { text: status, color: '#6b7280', bg: '#f3f4f6' };
        }

        // 작업 수락
        async function acceptJob(jobId) {
            if (!confirm('이 작업을 수락하시겠습니까?')) return;
            
            try {
                await db.collection('jobs').doc(jobId).update({
                    partnerId: currentUser.uid,
                    status: 'matched',
                    'matching.acceptedAt': new Date().toISOString()
                });
                
                alert('작업이 수락되었습니다!');
                await loadPartnerData();
                renderPartnerDashboard();
            } catch (error) {
                console.error('작업 수락 오류:', error);
                alert('작업 수락 중 오류가 발생했습니다.');
            }
        }
    </script>
</body>
</html>