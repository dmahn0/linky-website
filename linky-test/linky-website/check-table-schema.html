<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸</title>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #22c55e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #16a34a;
        }
        .result {
            background: #f3f4f6;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f3f4f6;
            font-weight: bold;
        }
        .error {
            color: #ef4444;
        }
        .success {
            color: #16a34a;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š Supabase í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸</h1>

    <div class="section">
        <h2>1. Users í…Œì´ë¸” êµ¬ì¡° í™•ì¸</h2>
        <button onclick="checkTableSchema()">í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ì¡°íšŒ</button>
        <button onclick="getSampleData()">ìƒ˜í”Œ ë°ì´í„° ì¡°íšŒ</button>
        <div id="schemaResult" class="result"></div>
    </div>

    <div class="section">
        <h2>2. ìµœì†Œ í•„ìˆ˜ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testMinimalInsert()">ìµœì†Œ ë°ì´í„° ì‚½ì… í…ŒìŠ¤íŠ¸</button>
        <div id="minimalResult" class="result"></div>
    </div>

    <div class="section">
        <h2>3. ë‹¨ê³„ë³„ í•„ë“œ í…ŒìŠ¤íŠ¸</h2>
        <button onclick="testFieldByField()">í•„ë“œë³„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <div id="fieldResult" class="result"></div>
    </div>

    <script>
        // Supabase ì´ˆê¸°í™”
        const supabaseUrl = 'https://mzihuflrbspvyjknxlad.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16aWh1ZmxyYnNwdnlqa254bGFkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MTk3ODgsImV4cCI6MjA2ODM5NTc4OH0.UDwv6eknjWwmbZ9WsRioi3J23_1az9O1pJFlnKgQ88s';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey);

        // í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ í™•ì¸
        async function checkTableSchema() {
            const result = document.getElementById('schemaResult');
            result.innerHTML = 'ì¡°íšŒ ì¤‘...';
            
            try {
                // ë¹ˆ ì¿¼ë¦¬ë¡œ ì—ëŸ¬ ìœ ë°œí•˜ì—¬ ìŠ¤í‚¤ë§ˆ ì •ë³´ ì–»ê¸°
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .limit(1);
                
                if (data && data.length > 0) {
                    const columns = Object.keys(data[0]);
                    result.innerHTML = '<h3>Users í…Œì´ë¸” ì»¬ëŸ¼:</h3>';
                    result.innerHTML += '<table>';
                    result.innerHTML += '<tr><th>ì»¬ëŸ¼ëª…</th><th>ìƒ˜í”Œ ê°’</th><th>íƒ€ì…</th></tr>';
                    
                    columns.forEach(col => {
                        const value = data[0][col];
                        const type = Array.isArray(value) ? 'array' : typeof value;
                        result.innerHTML += `<tr><td>${col}</td><td>${JSON.stringify(value)}</td><td>${type}</td></tr>`;
                    });
                    
                    result.innerHTML += '</table>';
                } else {
                    result.innerHTML = 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¹ˆ í…Œì´ë¸”ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                }
                
            } catch (error) {
                result.innerHTML = `<span class="error">ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        // ìƒ˜í”Œ ë°ì´í„° ì¡°íšŒ
        async function getSampleData() {
            const result = document.getElementById('schemaResult');
            result.innerHTML = 'ì¡°íšŒ ì¤‘...';
            
            try {
                const { data, error } = await supabaseClient
                    .from('users')
                    .select('*')
                    .eq('type', 'partner')
                    .limit(3);
                
                if (error) throw error;
                
                result.innerHTML = '<h3>íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ìƒ˜í”Œ (ìµœëŒ€ 3ê°œ):</h3>';
                result.innerHTML += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
            } catch (error) {
                result.innerHTML = `<span class="error">ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        // ìµœì†Œ ë°ì´í„° ì‚½ì… í…ŒìŠ¤íŠ¸
        async function testMinimalInsert() {
            const result = document.getElementById('minimalResult');
            result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const testEmail = `test_${Date.now()}@example.com`;
            
            try {
                // 1. Auth ì‚¬ìš©ì ìƒì„±
                const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                    email: testEmail,
                    password: 'test123456'
                });
                
                if (authError) throw authError;
                
                result.innerHTML = 'âœ… Auth ì‚¬ìš©ì ìƒì„± ì„±ê³µ\n';
                result.innerHTML += `ì‚¬ìš©ì ID: ${authData.user.id}\n\n`;
                
                // 2. ìµœì†Œ í•„ìˆ˜ í•„ë“œë§Œìœ¼ë¡œ ì‹œë„
                const minimalData = {
                    uid: authData.user.id,
                    email: testEmail,
                    name: 'í…ŒìŠ¤íŠ¸',  // nameì€ NOT NULL
                    type: 'partner'
                };
                
                result.innerHTML += 'ìµœì†Œ ë°ì´í„°ë¡œ ì‚½ì… ì‹œë„:\n';
                result.innerHTML += JSON.stringify(minimalData, null, 2) + '\n\n';
                
                const { error: dbError } = await supabaseClient
                    .from('users')
                    .insert([minimalData]);
                
                if (dbError) {
                    result.innerHTML += `<span class="error">âŒ ì‹¤íŒ¨: ${dbError.message}</span>\n`;
                    result.innerHTML += `ìƒì„¸: ${JSON.stringify(dbError, null, 2)}`;
                } else {
                    result.innerHTML += '<span class="success">âœ… ì„±ê³µ! ìµœì†Œ í•„ë“œ: uid, email, type</span>';
                }
                
            } catch (error) {
                result.innerHTML += `<span class="error">ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }

        // í•„ë“œë³„ í…ŒìŠ¤íŠ¸
        async function testFieldByField() {
            const result = document.getElementById('fieldResult');
            result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...\n';
            
            const testEmail = `test_${Date.now()}@example.com`;
            
            try {
                // Auth ì‚¬ìš©ì ìƒì„±
                const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                    email: testEmail,
                    password: 'test123456'
                });
                
                if (authError) throw authError;
                
                const baseData = {
                    uid: authData.user.id,
                    email: testEmail,
                    type: 'partner'
                };
                
                // í…ŒìŠ¤íŠ¸í•  í•„ë“œë“¤
                const testFields = [
                    { name: 'name', value: 'í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì' },
                    { name: 'phone', value: '010-1234-5678' },
                    { name: 'status', value: 'approved' },
                    { name: 'created_at', value: new Date().toISOString() },
                    { name: 'realName', value: 'ì‹¤ëª…' },
                    { name: 'residence', value: 'ì„œìš¸ì‹œ' },
                    { name: 'workAreas', value: ['ê°•ë‚¨êµ¬'] },
                    { name: 'transportation', value: 'public' }
                ];
                
                result.innerHTML = 'í•„ë“œë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼:\n\n';
                
                for (const field of testFields) {
                    const testData = { ...baseData, [field.name]: field.value };
                    
                    try {
                        const { error } = await supabaseClient
                            .from('users')
                            .insert([testData]);
                        
                        if (error) {
                            result.innerHTML += `âŒ ${field.name}: ì‹¤íŒ¨ - ${error.message}\n`;
                        } else {
                            result.innerHTML += `âœ… ${field.name}: ì„±ê³µ\n`;
                        }
                        
                        // ì‚½ì…í•œ ë°ì´í„° ì‚­ì œ (ì •ë¦¬)
                        await supabaseClient
                            .from('users')
                            .delete()
                            .eq('uid', authData.user.id);
                        
                    } catch (e) {
                        result.innerHTML += `âŒ ${field.name}: ì˜¤ë¥˜ - ${e.message}\n`;
                    }
                }
                
            } catch (error) {
                result.innerHTML += `<span class="error">ì˜¤ë¥˜: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>