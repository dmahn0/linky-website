<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Test Partner Signup</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="src/shared/js/config.js"></script>
    <script src="src/shared/js/auth.js"></script>
</head>
<body>
    <h1>Test Partner Signup</h1>
    <button onclick="testSignup()">Test Signup</button>
    <div id="results"></div>

    <script>
        async function testSignup() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing signup...</p>';

            const testEmail = `test_partner_${Date.now()}@test.com`;
            const testData = {
                email: testEmail,
                password: 'testpass123',
                name: 'Test Partner',
                phone: '010-1234-5678',
                address: 'Test Address',
                preferredJobTypes: ['daily_cleaning'],
                preferredAreas: ['강남구']
            };

            console.log('🚀 Starting test signup with:', testEmail);
            
            try {
                const result = await authManager.signup(
                    testData.email,
                    testData.password,
                    'partners',
                    {
                        name: testData.name,
                        phone: testData.phone,
                        address: testData.address,
                        preferred_job_types: testData.preferredJobTypes,
                        preferred_areas: testData.preferredAreas,
                        verification_status: 'pending',
                        availability_status: 'offline',
                        status: 'pending'
                    }
                );

                console.log('📊 Signup result:', result);

                if (result.success) {
                    resultsDiv.innerHTML = `
                        <h2>✅ Signup Successful!</h2>
                        <p><strong>Email:</strong> ${testEmail}</p>
                        <p><strong>User ID:</strong> ${result.user.id}</p>
                        <p><strong>Profile ID:</strong> ${result.profile.id}</p>
                        <p><strong>Profile auth_uid:</strong> ${result.profile.auth_uid}</p>
                    `;

                    // Verify the data was inserted correctly
                    console.log('🔍 Verifying database insertion...');
                    setTimeout(async () => {
                        try {
                            const { data, error } = await supabase
                                .from('partners_users')
                                .select('*')
                                .eq('email', testEmail)
                                .single();

                            console.log('📋 Database verification:', { data, error });
                            
                            if (data && data.auth_uid) {
                                resultsDiv.innerHTML += '<p>✅ Database verification successful - auth_uid properly linked!</p>';
                            } else {
                                resultsDiv.innerHTML += '<p>❌ Database verification failed - auth_uid is null</p>';
                            }
                        } catch (verifyError) {
                            console.error('Verification error:', verifyError);
                            resultsDiv.innerHTML += `<p>❌ Verification error: ${verifyError.message}</p>`;
                        }
                    }, 1000);
                } else {
                    resultsDiv.innerHTML = `
                        <h2>❌ Signup Failed</h2>
                        <p><strong>Error:</strong> ${result.error}</p>
                    `;
                }
            } catch (error) {
                console.error('🚨 Test signup error:', error);
                resultsDiv.innerHTML = `
                    <h2>❌ Test Error</h2>
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>